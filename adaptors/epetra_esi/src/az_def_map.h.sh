#!/bin/sh

echo " "

if [ ${#} = 0 ] ; then \
 echo "Usage: az_def_map.h.sh <path>/az_aztec_defs.h";\
 echo " ";\
 exit 1;\
fi

infile=${1}

if [ -f ${infile} ] ; then \
  echo "Using input file ${infile}..."; \
  echo " ";\
else \
  echo "input file ${infile} doesn't exist. exiting.";\
  exit 1;\
fi

if [ -f az_def_map.h.awk ] ; then \
  echo "Taking awk pattern-action line from 'az_def_map.h.awk' file.";\
else\
  echo "Necessary file 'az_def_map.h.awk' doesn't exist. exiting.";\
  exit 1;\
fi

#
# Use awk, with the pattern-action line in 'az_def_map.h.awk', to take all
# lines from the input file that contain the pattern:
# "#define <name> <number>"
# and produce a file containing on each line:
# ' "<name> <number>", '
#
(awk -f az_def_map.h.awk ${infile} > uad.1)
if [ ${?} != 0 ] ; then \
 echo "error running awk on ${infile}. exiting.";\
 exit 1;\
fi

echo "\"terminator\"};" >> uad.1

lastline=`wc uad.1 | awk '{ print "static int num_def_strs = " $1 ";" }' -`

(rm -f az_def_map.h)

echo "/* This file generated by the script az_def_map.h.sh. */">az_def_map.h
echo "static const char* az_def_map[] = {" >> az_def_map.h
(cat uad.1 >> az_def_map.h)
echo ${lastline} >> az_def_map.h

(rm -f uad.1)

echo " "
echo "created file az_def_map.h"
echo " "
exit 0

