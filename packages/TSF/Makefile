############################################################################
#
# Root-level makefile, with which we can build the following targets:
#
# library: compile the code and assemble a ".a" library file.
#
# tests: run a test suite, returning a pass/fail flag for each test
#
# parallelTests: run the test suite in parallel
#
# clean: wipe out files generated by the current build (all .o, .a, and .d
#        files in the build subdirectories) plus any junk files such as cores
#
# spotless: wipe out all builds, plus junk files.
#
# etags: make tags tables for emacs
#
# manual: runs doxygen to make a source-generated reference manual
#
#
############################################################################

# include initialization and site definition files
include Build/Makefile.site
include Build/Makefile.tsf

# ------------------------- define targets ------------------------------

# build the project library
library:
	(cd src; gmake lib)

# run pass/fail tests in serial
tests:
	(cd examples; gmake tests)

# run pass/fail tests in parallel
parallelTests:
	(cd examples; gmake parallelTests) 

# remove current build
clean: 
	gmake cleanjunk
	gmake libclean
	gmake srcclean
	gmake docclean



libclean:
	$(RM)  lib/*.a lib/*~ lib/core lib/#*

srcclean:
	$(RM) src/*/*.d src/*/*.o examples/*/*.o examples/*/*.d examples/*/*.e

docclean:
	$(RM) -r doc/html doc/UsersGuide/*.dvi doc/UsersGuide/*.log doc/UsersGuide/*.aux doc/UsersGuide/UsersGuide

# remove junk files such as cores and emacs backups
cleanjunk:
	$(RM) *~ */*~ */*/*~ */*/*/*~ */*/*/*/*~ 
	$(RM) #* */#* */*/#* */*/*/#* */*/*/*/#* 
	$(RM) core */core */*/core */*/*/core */*/*/*/core
	$(RM) -r */SunWS_cache */*/SunWS_cache */*/*/SunWS_cache
	$(RM) -r */Templates.DB */*/Templates.DB */*/*/Templates.DB 

# make emacs tags
tags:
	etags src/*/*.h src/*/*.cpp examples/*/*.cpp

# make the reference manual
manual:
	(cd doc; gmake manual)


