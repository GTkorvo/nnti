<!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 ! Zoltan Dynamic Load-Balancing Library for Parallel Applications            !
 ! Copyright (c) 2000, Sandia National Laboratories.                          !
 ! For more info, see the README file in the top-level Zoltan directory.      ! 
 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
>
<! CVS File Information
     $RCSfile$
     $Author$
     $Date$
     $Revision$
>

<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.04 [en] (X11; U; SunOS 4.1.3_U1 sun4m) [Netscape]">
   <META NAME="sandia.approved" CONTENT="SAND99-1377">
   <META NAME="author" CONTENT="karen devine, kddevin@sandia.gov">

   <TITLE>Zoltan User's Guide:  Migration Interface</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF">

<div ALIGN=right><b><i><a href="ug.html">Zoltan User's Guide</a>&nbsp; |&nbsp; <a href="ug_query.html">Next</a>&nbsp; |&nbsp; <a href="ug_interface_augment.html">Previous</a></i></b></div>


<H2>
<A NAME="Migration Functions"></A>Migration Functions</H2>
If requested, Zoltan can automatically transfer an application's data between
processors to realize the new decomposition. This functionality will be
performed as part of the call to <B><A HREF="ug_interface_lb.html#LB_Balance">LB_Balance</A></B>
if the <B><A HREF="ug_alg.html#General_Parameters">AUTO_MIGRATE</A></B>
parameter is set to TRUE (nonzero) via a call to <B><A HREF="ug_interface_lb.html#LB_Set_Param">LB_Set_Param</A></B>.
This approach is effective for when the data to be moved is relatively
simple.  For more complicated data movement,
the application can leave <B><A HREF="ug_alg.html#General_Parameters">AUTO_MIGRATE</A></B>
FALSE and call <B><A HREF="#LB_Help_Migrate">LB_Help_Migrate</A></B> itself.
In either case, <A HREF="ug_query_mig.html#Migration Query Functions">routines
to pack and unpack object data</A> must be provided by the application.
See <A HREF="ug_examples_mig.html#Migration Example">Migration Examples</A>
for examples with and without auto-migration.

<P>The following functions are the migration interface functions.
Their detailed descriptions can be found below.
<BLOCKQUOTE><B><A HREF="#LB_Compute_Destinations">LB_Compute_Destinations</A></B>
<BR><B><A HREF="#LB_Help_Migrate">LB_Help_Migrate</A></B></BLOCKQUOTE>

<HR WIDTH="100%">
<TABLE WIDTH="100%" NOSAVE >
<TR NOSAVE>
<TD VALIGN=TOP NOSAVE>C:</TD>

<TD><A NAME="LB_Compute_Destinations"></A>int <B>LB_Compute_Destinations</B>
(struct&nbsp;<B>LB_Struct</B>&nbsp;*<I>lb</I>,
int&nbsp;<I>num_gid_entries</I>,
int&nbsp;<I>num_lid_entries</I>,
int&nbsp;<I>num_import</I>,
<a href="ug_usage.html#Data Types for Object IDs">LB_ID_PTR</a>&nbsp;<I>import_global_ids</I>,
<a href="ug_usage.html#Data Types for Object IDs">LB_ID_PTR</a>&nbsp;<I>import_local_ids</I>,
int&nbsp;*<I>import_procs</I>,
int&nbsp;*<I>num_export</I>,
<a href="ug_usage.html#Data Types for Object IDs">LB_ID_PTR</a>&nbsp;*<I>export_global_ids</I>,
<a href="ug_usage.html#Data Types for Object IDs">LB_ID_PTR</a>&nbsp;*<I>export_local_ids</I>,
int&nbsp;**<I>export_procs</I>);&nbsp;
<BR>&nbsp;</TD>
</TR>

<TR NOSAVE>
<TD VALIGN=TOP WIDTH="15%" NOSAVE>FORTRAN:</TD>

<TD>FUNCTION <B>LB_Compute_Destinations</B>(<I>lb, num_gid_entries, num_lid_entries, num_import, import_global_ids,
import_local_ids, import_procs, num_export, export_global_ids, export_local_ids,
export_procs</I>)&nbsp;
<BR>INTEGER(LB_INT) :: LB_Compute_Destinations&nbsp;
<BR>TYPE(LB_Struct),INTENT(IN) :: lb&nbsp;
<BR>INTEGER(LB_INT), INTENT(IN) :: num_gid_entries, num_lid_entries&nbsp;
<BR>INTEGER(LB_INT), INTENT(IN) :: num_import&nbsp;
<BR>INTEGER(LB_INT), INTENT(OUT) :: num_export&nbsp;
<BR>INTEGER(LB_INT), POINTER, DIMENSION(:) :: import_global_ids, export_global_ids&nbsp;
<BR>INTEGER(LB_INT), POINTER, DIMENSION(:) :: import_local_ids, export_local_ids&nbsp;
<BR>INTEGER(LB_INT), POINTER, DIMENSION(:) :: import_procs, export_procs&nbsp;
</TD>
</TR>
</TABLE>

<HR WIDTH="100%"><B>LB_Compute_Destinations</B> computes the inverse communication
map needed to export data. That is, given, for each processor, a list of
non-local objects assigned to the processor, <B>LB_Compute_Destinations</B>
computes the list of objects each processor needs to export to other processors
to satisfy their assignments of non-local objects.
<BR>&nbsp;
<TABLE WIDTH="100%" >
<TR>
<TD VALIGN=TOP WIDTH="20%"><B>Parameters:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; lb</I></TD>

<TD>Pointer to the load-balancing structure, created by 
<B><A HREF="ug_interface_init.html#LB_Create">LB_Create</A></B>,
to be used in this invocation of the migration routine.</TD>
</TR>

<tr NOSAVE>
<td VALIGN=TOP NOSAVE>&nbsp;&nbsp;&nbsp; <i>num_gid_entries</i></td>

<td>The number of array entries used to describe a single
global ID.&nbsp; This value is the maximum value over all processors of
the parameter <a href="ug_alg.html#NUM_GID_ENTRIES">NUM_GID_ENTRIES</a>.</td>
</tr>

<tr NOSAVE>
<td VALIGN=TOP NOSAVE>&nbsp;&nbsp;&nbsp; <i>num_lid_entries</i></td>

<td>The number of array entries used to describe a single
local ID.&nbsp; This value is the maximum value over all processors of
the parameter <a href="ug_alg.html#NUM_LID_ENTRIES">NUM_LID_ENTRIES</a>.</td>
</tr>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; num_import&nbsp;</I></TD>

<TD>The number of objects that are needed by this processor that are stored
on other processors in the old decomposition (i.e., the number of objects
to be imported to this processor).</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; import_global_ids</I></TD>

<TD>An array of <I>num_import</I> global IDs of objects
needed by this processor that are stored on other processors in the old
decomposition.<br>
(size = <i>num_import</i> * <i>num_gid_entries</i>)</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; import_local_ids</I></TD>

<TD>An array of <I>num_import</I> local IDs of objects
needed by this processor that are stored on other processors in the old
decomposition.<br>
(size = <i>num_import</i> * <i>num_lid_entries</i>)</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; import_procs</I></TD>

<TD>An array of size <I>num_import </I>listing the processor IDs of the
processors that own objects needed by this processor (i.e., the source
processors).</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; num_export</I></TD>

<TD>Upon return, the number of objects that were stored on this processor
in the previous decomposition that are needed by other processors (i.e.,
the number of objects that must be sent from this processor to other processors).</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; export_global_ids</I></TD>

<TD>Upon return, an array of <I>num_export</I> global
IDs of objects to be sent from this processor.<br>
(size = <i>num_export</i> * <i>num_gid_entries</i>)
</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; export_local_ids</I></TD>

<TD>&nbsp;Upon return, an array of <I>num_export</I> local
IDs of objects to be sent from this processor.<br>
(size = <i>num_export</i> * <i>num_lid_entries</i>)
</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; export_procs</I></TD>

<TD>Upon return, an array of size <I>num_export</I> listing the processor
IDs of processors that need the sent objects (i.e., the destination processors).</TD>
</TR>

<TR>
<TD><B>Returned Value:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP>&nbsp;&nbsp;&nbsp; int</TD>

<TD><A HREF="ug_interface.html#Error Codes">Error code</A>.</TD>
</TR>
</TABLE>
&nbsp;

<P>
<HR WIDTH="100%">
<TABLE WIDTH="100%" NOSAVE >
<TR NOSAVE>
<TD VALIGN=TOP NOSAVE>C:</TD>

<TD><A NAME="LB_Help_Migrate"></A>int <B>LB_Help_Migrate</B>
(struct&nbsp;<B>LB_Struct</B>&nbsp;*<I>lb</I>,
int&nbsp;<I>num_gid_entries</I>,
int&nbsp;<I>num_lid_entries</I>,
int&nbsp;<I>num_import</I>,
<a href="ug_usage.html#Data Types for Object IDs">LB_ID_PTR</a>&nbsp;<I>import_global_ids</I>,
<a href="ug_usage.html#Data Types for Object IDs">LB_ID_PTR</a>&nbsp;<I>import_local_ids</I>,
int&nbsp;*<I>import_procs</I>,
int&nbsp;<I>num_export</I>,
<a href="ug_usage.html#Data Types for Object IDs">LB_ID_PTR</a>&nbsp;<I>export_global_ids</I>,
<a href="ug_usage.html#Data Types for Object IDs">LB_ID_PTR</a>&nbsp;<I>export_local_ids</I>,
int&nbsp;*<I>export_procs</I>);&nbsp;
<BR>&nbsp;</TD>
</TR>

<TR NOSAVE>
<TD VALIGN=TOP WIDTH="15%" NOSAVE>FORTRAN:</TD>

<TD>FUNCTION <B>LB_Help_Migrate</B>(<I>lb, num_gid_entries, num_lid_entries, num_import, import_global_ids,
import_local_ids, import_procs, num_export, export_global_ids, export_local_ids,
export_procs</I>)&nbsp;
<BR>INTEGER(LB_INT) :: LB_Help_Migrate&nbsp;
<BR>TYPE(LB_Struct),INTENT(IN) :: lb&nbsp;
<BR>INTEGER(LB_INT), INTENT(IN) :: num_gid_entries, num_lid_entries&nbsp;
<BR>INTEGER(LB_INT), INTENT(IN) :: num_import, num_export&nbsp;
<BR>INTEGER(LB_INT), POINTER, DIMENSION(:) :: import_global_ids, export_global_ids&nbsp;
<BR>INTEGER(LB_INT), POINTER, DIMENSION(:) :: import_local_ids, export_local_ids&nbsp;
<BR>INTEGER(LB_INT), POINTER, DIMENSION(:) :: import_procs, export_procs&nbsp;
</TD>
</TR>
</TABLE>

<HR WIDTH="100%"><B>LB_Help_Migrate</B> takes lists of objects to be sent
to other processors, along with the destinations of those objects, and
performs the operations necessary to send the data associated with those
objects to their destinations. If a migration pre-processing routine (<B><A HREF="ug_query_mig.html#LB_PRE_MIGRATE_FN">LB_PRE_MIGRATE_FN_TYPE</A></B>)
is specified, <B>LB_Help_Migrate</B> first calls that function. It then
calls an application-registered function (<B><A HREF="ug_query_mig.html#LB_OBJ_SIZE_FN">LB_OBJ_SIZE_FN_TYPE</A></B>)
to obtain the size of a migrating object's data. For each object, it calls
an application-registered packing routine (<B><A HREF="ug_query_mig.html#LB_PACK_OBJ_FN">LB_PACK_OBJ_FN_TYPE</A></B>)
to load communication buffers. It communicates the buffers to the destination
processors. If a migration mid-processing routine 
(<b><a href="ug_query_mig.html#LB_MID_MIGRATE_FN">LB_MID_MIGRATE_FN_TYPE</a></b>)
is registered, <b>LB_Help_Migrate</b> calls it after the communication.
Finally, for each object received, it calls an application-registered
unpacking routine (<B><A HREF="ug_query_mig.html#LB_UNPACK_OBJ_FN">LB_UNPACK_OBJ_FN_TYPE</A></B>)
to move the data from the received communication buffer into the new processor's
data structures.
<BR>&nbsp;
<TABLE WIDTH="100%" >
<TR>
<TD VALIGN=TOP WIDTH="20%"><B>Parameters:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; lb</I></TD>

<TD>Pointer to the load-balancing structure, created by 
<B><A HREF="ug_interface_init.html#LB_Create">LB_Create</A></B>,
to be used in this invocation of the migration routine.</TD>
</TR>

<tr NOSAVE>
<td VALIGN=TOP NOSAVE>&nbsp;&nbsp;&nbsp; <i>num_gid_entries</i></td>

<td>The number of array entries used to describe a single
global ID.&nbsp; This value is the maximum value over all processors of
the parameter <a href="ug_alg.html#NUM_GID_ENTRIES">NUM_GID_ENTRIES</a>.</td>
</tr>

<tr NOSAVE>
<td VALIGN=TOP NOSAVE>&nbsp;&nbsp;&nbsp; <i>num_lid_entries</i></td>

<td>The number of array entries used to describe a single
local ID.&nbsp; This value is the maximum value over all processors of
the parameter <a href="ug_alg.html#NUM_LID_ENTRIES">NUM_LID_ENTRIES</a>.</td>
</tr>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; num_import&nbsp;</I></TD>

<TD>The number of objects that are needed by this processor that are stored
on other processors in the old decomposition (i.e., the number of objects
to be imported to this processor).</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; import_global_ids</I></TD>

<TD>An array of <I>num_import</I> global IDs of objects
needed by this processor that are stored on other processors in the old
decomposition.<br>
(size = <i>num_import</i> * <i>num_gid_entries</i>)
</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; import_local_ids</I></TD>

<TD>An array of <I>num_import</I> local IDs of objects
needed by this processor that are stored on other processors in the old
decomposition.<br>
(size = <i>num_import</i> * <i>num_lid_entries</i>)
</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; import_procs</I></TD>

<TD>An array of size <I>num_import</I> listing the processor IDs of the
processors that own objects needed by this processor (i.e., the source
processors).</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; num_export</I></TD>

<TD>The number of objects that were stored on this processor in the previous
decomposition that are needed by other processors (i.e., the number of
objects that must be sent from this processor to other processors).</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; export_global_ids</I></TD>

<TD>An array of <I>num_export</I> global IDs of objects
to be sent from this processor.<br>
(size = <i>num_export</i> * <i>num_gid_entries</i>)</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; export_local_ids</I></TD>

<TD>An array of <I>num_export</I> local IDs of objects
to be sent from this processor.<br>
(size = <i>num_export</i> * <i>num_lid_entries</i>)
</TD>
</TR>

<TR>
<TD VALIGN=TOP><I>&nbsp;&nbsp;&nbsp; export_procs</I></TD>

<TD>An array of size <I>num_export</I> listing the processor IDs of processors
that need the sent objects (i.e., the destination processors).</TD>
</TR>

<TR>
<TD><B>Returned Value:</B></TD>

<TD></TD>
</TR>

<TR>
<TD VALIGN=TOP>&nbsp;&nbsp;&nbsp; int</TD>

<TD><A HREF="ug_interface.html#Error Codes">Error code</A>.</TD>
</TR>
</TABLE>
&nbsp;

<P>
<HR WIDTH="100%">[<A HREF="ug.html">Table of Contents</A>&nbsp; |&nbsp;
<A HREF="ug_query.html">Next:&nbsp; Application-Registered Query Functions</A>&nbsp;
|&nbsp; <A HREF="ug_interface_augment.html">Previous:&nbsp; Functions for
Augmenting a Decomposition</A>]
</BODY>
</HTML>
