# To run makefile:
#    1) set environment variable TRILINOS_ARCH to sgi, sun, tflop, or pclinux.
#       Other machines require an appropriate makefile.$(TRILINOS_ARCH) file.
#    2) Set TRILINOS_COMM to SERIAL or MPI
#    3) (Optional) Set TRILINOS_ID to make unique version for same 
#       architecture and communication mode.
#
#    4) Make the archive $(LIBMACHDEP) by typing 'make'.
#


TRILINOS_TARGET = $(TRILINOS_ARCH).$(TRILINOS_COMM)$(TRILINOS_ID)

LIBMACHDEP = $(TRILINOS_HOME)/lib/$(TRILINOS_TARGET)/libmachdep.a

include $(TRILINOS_HOME)/etc/makefile.$(TRILINOS_TARGET)

# Machdep communication defines
MACHDEP_COMM_SERIAL          = SERIAL
MACHDEP_COMM_MPI             = MPI
MACHDEP_COMM                 = $(MACHDEP_COMM_$(TRILINOS_COMM))

DEFINES= -D$(TRILINOS_ARCH) $(MACHDEP_ARCH_DEFINES) -D$(MACHDEP_COMM) \
         -DIFPACK -DSPARSEBLAS $(PETRA_ARCH_DEFINES)

INCLUDES = $(ARCH_INCLUDES) -I$(TRILINOS_HOME)/src/ifpack \
           -I$(TRILINOS_HOME)/src/machdep $(BLAS_INCLUDES) \
           $(SPBLAS_INCLUDES)

LIB_PATHS=

CFLAGS=$(ARCH_CFLAGS) $(DEFINES) $(INCLUDES)
FFLAGS=$(ARCH_FFLAGS) 
CXXFLAGS=$(ARCH_CXXFLAGS) $(DEFINES) $(INCLUDES)
#=======================================================================
# MACHDEP source files
#=======================================================================

#
# Machine dependent timing routine
#
TIME_GENERIC    = md_timer_generic.c
TIME_SUN4       = md_timer_sun.c
TIME_SOLARIS    = md_timer_sun.c
TIME_SGI        = md_timer_sun.c
TIME_SGI32      = md_timer_sun.c
TIME_SGI64      = md_timer_sun.c
TIME_SGIM4      = md_timer_sun.c
TIME_SGI10K     = md_timer_sun.c
TIME_DEC        = md_timer_sun.c
TIME_I860       = md_timer_intel.c
TIME_HP         = md_timer_generic.c
TIME_SUNMOS     = md_timer_intel.c
TIME_NCUBE      = md_timer_ncube.c
TIME_SP2        = md_timer_generic.c
TIME_T3E        = md_timer_mpi.c
TIME_LINUX_MPI  = md_timer_mpi.c
TIME_LINUX_SERIAL = md_timer_generic.c
TIME_LINUX      = $(TIME_LINUX_$(TRILINOS_COMM))
TIME_TFLOP      = md_timer_intel.c

#
# Communication package
#
COMM_SERIAL      = md_wrap_scalar_c.c
COMM_I860        = md_wrap_intel_c.c
COMM_MPI         = md_wrap_mpi_c.c
COMM_NCUBE       = md_wrap_ncube_c.c
COMM_SUNMOS      = md_wrap_puma_c.c

MACHDEP_C = $(TIME_$(TRILINOS_ARCH)) $(COMM_$(TRILINOS_COMM))
MACHDEP_F =

#=======================================================================
# MACHDEP include files
#=======================================================================

MACHDEP_INC = 

MACHDEP_OBJ          = $(MACHDEP_C:.c=.o) $(MACHDEP_F:.f=.o)

$(LIBMACHDEP): $(MACHDEP_OBJ)
	$(AR) rcv $(LIBMACHDEP) $(MACHDEP_OBJ)
	$(RANLIB) $(LIBMACHDEP)

#
# dependencies for 'f' files (none at this time)
#
#include ../../etc/depends.machdep

clean:
	@echo "junk" > dummy.o
	@rm -f *.o  $(LIBMACHDEP) *~
