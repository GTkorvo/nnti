PROJECT(epetra C CXX Fortran)

# Setup package version
SET(EPETRA_VERSION "3.7d")

# Flag for turning on MPI support
OPTION(ENABLE_MPI 
       "Build with MPI for parallel codes."
       OFF
)

# Flag to enable tests
OPTION(ENABLE_TESTS
       "Build tests for this package."
       OFF
)

# Flag to enable examples
OPTION(ENABLE_EXAMPLES
       "Build examples for this package."
       OFF
)

SET(CMAKE_MODULE_PATH "${epetra_SOURCE_DIR}/cmake")
INCLUDE_DIRECTORIES(${CMAKE_MODULE_PATH})

# MPI related configuration
IF(ENABLE_MPI)
  INCLUDE(ConfigureMPI)
ENDIF(ENABLE_MPI)

# Use secure versions of CRT methods in Windows 
# (addresses C4996 build errors in MSVS)
IF(WIN32)
  ADD_DEFINITIONS(-D_CRT_SECURE_CPP_OVERLOAD_STANDARD_NAMES)
ENDIF(WIN32)

ADD_SUBDIRECTORY(src)

IF(ENABLE_TESTS OR ENABLE_EXAMPLES)
  ENABLE_TESTING()
  INCLUDE(Dart)
  IF(ENABLE_TESTS)
    ADD_SUBDIRECTORY(test)
  ENDIF(ENABLE_TESTS)
  IF(ENABLE_EXAMPLES)
    ADD_SUBDIRECTORY(example)
  ENDIF(ENABLE_EXAMPLES)
ENDIF(ENABLE_TESTS OR ENABLE_EXAMPLES)

# Packaging
SET(CPACK_PACKAGE_DESCRIPTION "Epetra is a linear algebra services package.")
SET(CPACK_PACKAGE_FILE_NAME "epetra-setup-${EPETRA_VERSION}")
SET(CPACK_PACKAGE_INSTALL_DIRECTORY "Epetra ${EPETRA_VERSION}")
SET(CPACK_PACKAGE_REGISTRY_KEY "Epetra ${EPETRA_VERSION}")
SET(CPACK_PACKAGE_NAME "epetra")
SET(CPACK_PACKAGE_VENDOR "Sandia National Laboratories")
SET(CPACK_PACKAGE_VERSION "${EPETRA_VERSION}")
SET(CPACK_SOURCE_GENERATOR "TGZ;TBZ2")
SET(CPACK_SOURCE_FILE_NAME "epetra-source-${EPETRA_VERSION}")

IF(WIN32)
	SET(CPACK_GENERATOR "NSIS")
ENDIF(WIN32)

INCLUDE(CPack)
