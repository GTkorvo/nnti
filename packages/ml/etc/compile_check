#!/bin/sh
ARCH=$1
USE_MPI=$2
BLAS_LIB=$3
LAPACK_LIB=$4
EXES=
if test $# -le 1
then
USE_MPI=no
fi
if test $# -le 2
then
BLAS_LIB=no
fi
if test $# -le 3
then
LAPACK_LIB=no
fi
if test $# -ge 5
then
  echo "Usage: compile_check architecture [use_mpi blas_lib lapack_lib]"
  exit
fi
if test $# -le 0
then
  echo "Usage: compile_check architecture [use_mpi blas_lib lapack_lib]"
  exit
fi
cd ..
ML_HOME=`pwd`
cd Obj
/bin/rm -f superlapack aztecsuperblas aztecsupermpi aztecnosuper noaztecsuper aztecsuper noaztecnosuper
cd ..
tLAPACK=`echo ${LAPACK_LIB} | sed "s/ /x/g"`
###############################################################3
if test `expr ${tLAPACK}` != 'no'
then
EXES=`echo $EXES superlapack`
#
#  no Aztec with superlu and blas and lapack
#
echo "testing with Superlu and aztec and lapack"
etc/clean_all
cd Obj
make clean
cd ..
\rm -f .compile_input
echo $ARCH  >> .compile_input
echo yes >> .compile_input
TEMP=`echo ${LAPACK_LIB}x | sed "s/ /x/g"`
if test `expr ${TEMP}` = 'xx'
then
   echo NA >> .compile_input
   echo NA >> .compile_input
else
   T3=`echo ${LAPACK_LIB} | grep ":::"`
   T4=`echo ${T3}x | sed "s/ /x/g"`
   if test `expr ${T4}` != 'x'
   then
      echo ${LAPACK_LIB} | sed s"/:::.*//" >> .compile_input
      echo ${LAPACK_LIB} | sed s"/.*::://" >> .compile_input
   else
    echo >> .compile_input
    echo ${LAPACK_LIB} >> .compile_input
   fi
fi
echo yes >> .compile_input
TEMP=`echo ${BLAS_LIB}x | sed "s/ /x/g"`
if test `expr ${TEMP}` = 'xx'
then
   echo NA >> .compile_input
   echo NA >> .compile_input
else
   T3=`echo ${BLAS_LIB} | grep ":::"`
   T4=`echo ${T3}x | sed "s/ /x/g"`
   if test `expr ${T4}` != 'x'
   then
      echo ${BLAS_LIB} | sed s"/:::.*//" >> .compile_input
      echo ${BLAS_LIB} | sed s"/.*::://" >> .compile_input
   else
    echo >> .compile_input
    echo ${BLAS_LIB} >> .compile_input
   fi
fi
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo yes >> .compile_input
echo  >> .compile_input
echo yes >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
./installer < .compile_input
mv ${ML_HOME}/Obj/mlguide ${ML_HOME}/superlapack
fi
###############################################################3
if test `expr ${BLAS_LIB}` != 'no'
then
EXES=`echo $EXES aztecsuperblas`
#
#  Aztec with superlu and blas
#
echo "testing with Superlu and aztec and blas"
etc/clean_all
cd Obj
make clean
cd ..
\rm -f .compile_input
echo $ARCH  >> .compile_input
echo no >> .compile_input
echo yes >> .compile_input
TEMP=`echo ${BLAS_LIB}x | sed "s/ /x/g"`
if test `expr ${TEMP}` = 'xx'
then
   echo NA >> .compile_input
   echo NA >> .compile_input
else
   T3=`echo ${BLAS_LIB} | grep ":::"`
   T4=`echo ${T3}x | sed "s/ /x/g"`
   if test `expr ${T4}` != 'x'
   then
      echo ${BLAS_LIB} | sed s"/:::.*//" >> .compile_input
      echo ${BLAS_LIB} | sed s"/.*::://" >> .compile_input
   else
    echo >> .compile_input
    echo ${BLAS_LIB} >> .compile_input
   fi
fi
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo yes >> .compile_input
echo  >> .compile_input
echo no >> .compile_input
echo yes >> .compile_input
echo yes >> .compile_input
echo  >> .compile_input
echo yes >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
./installer < .compile_input
mv ${ML_HOME}/Obj/mlguide ${ML_HOME}/aztecsuperblas
fi
###############################################################3
if test `expr ${USE_MPI}` = 'yes'
then
EXES=`echo $EXES aztecsupermpi`
#
#  Aztec with superlu and MPI
#
echo "testing with Superlu and aztec and mpi"
etc/clean_all
cd Obj
make clean
cd ..
\rm -f .compile_input
echo $ARCH  >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo yes >> .compile_input
TEMP=`echo $MPI_INC_PATH x | sed "s/ /x/g"`
if test `expr ${TEMP}` != 'x'
then
echo yes >> .compile_input
echo $MPI_INC_PATH | sed "s/-I//" >> .compile_input
echo x >> .compile_input
else
echo no >> .compile_input
fi
TEMP=`echo $MPI_LIB_PATH x | sed "s/ /x/g"`
if test `expr ${TEMP}` != 'x'
then
echo yes >> .compile_input
echo $MPI_LIB_PATH | sed "s/-L//" >> .compile_input
else
echo no >> .compile_input
fi
echo >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo yes >> .compile_input
echo  >> .compile_input
echo no >> .compile_input
echo yes >> .compile_input
echo yes >> .compile_input
echo  >> .compile_input
echo yes >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
./installer < .compile_input
mv ${ML_HOME}/Obj/mlguide ${ML_HOME}/aztecsupermpi
fi
###############################################################3
#
#  Aztec but no superlu
#
EXES=`echo $EXES aztecnosuper`
echo "testing with Aztec but no superlu"
etc/clean_all
pwd
if test -d Obj
then
   cd Obj
   make clean
   cd ..
fi
\rm -f .compile_input
echo $ARCH >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo yes >> .compile_input
echo  >> .compile_input
echo no >> .compile_input
echo yes >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
./installer < .compile_input
mv ${ML_HOME}/Obj/mlguide ${ML_HOME}/aztecnosuper
#
# SuperLU no aztec
#
echo "testing with Superlu but no aztec"
EXES=`echo $EXES noaztecsuper`
etc/clean_all
cd Obj
make clean
cd ..
\rm -f .compile_input
echo $ARCH >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo yes >> .compile_input
echo  >> .compile_input
echo yes >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
./installer < .compile_input
mv ${ML_HOME}/Obj/mlguide ${ML_HOME}/noaztecsuper
#
#  Aztec with superlu
#
echo "testing with Superlu and aztec"
EXES=`echo $EXES aztecsuper`
etc/clean_all
cd Obj
make clean
cd ..
\rm -f .compile_input
echo $ARCH  >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo yes >> .compile_input
echo  >> .compile_input
echo no >> .compile_input
echo yes >> .compile_input
echo yes >> .compile_input
echo  >> .compile_input
echo yes >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
./installer < .compile_input
mv ${ML_HOME}/Obj/mlguide ${ML_HOME}/aztecsuper
#
#  no Aztec no superlu
#
echo "testing with no Superlu and no aztec"
EXES=`echo $EXES noaztecnosuper`
etc/clean_all
cd Obj
make clean
cd ..
\rm -f .compile_input
echo $ARCH >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
echo no >> .compile_input
./installer < .compile_input
mv ${ML_HOME}/Obj/mlguide ${ML_HOME}/noaztecnosuper
cd ${ML_HOME}
echo
echo
echo "Listing all the executables created during the test"
echo "Any files listed as 'not found' indicates an error"
echo "during the compile of this executable"
ls `echo $EXES`
