#!/bin/sh

\rm -f capper .undefs .undefs2 .thedefs
cc -o capper capper.c
pwd
echo $1 
echo $2
echo $3
echo $4
$1 $2 -I ../Obj -c lapack_driver.c
$3 $2 lapack_driver.o $4 2> .undefs
cat .undefs |  grep reference | sed "s/^.*: //" > .undefs2
tt=`grep MLFORTRAN lapack_driver.c | grep void | sed "s/^.*MLFORTRAN(//"| \
   sed "s/).*//"`
echo $tt
for i in $tt
do
bb=`grep -i $i .undefs2 | wc | sed "s/^ *//" | sed "s/ .*//"`
echo $i $bb
if test $bb -eq 0
then
NAME=`echo $i | capper`
${echo} "\\" >> .thedefs
${echo} -n "-DML_${NAME}_FUNC ">> .thedefs
fi
done
${echo} -DML_NOTHING >> .thedefs

#\rm -f capper .undefs .undefs2 