<?php 
  include 'common/header.php';
  include 'util.php';
  includeStyleSheet('styles.css'); 
  setFilename('expert.html');
  setTitle('Trilinos - WebSolver - Expert Page');
  setDir('./');
  include 'common/header.html';
?>

<!-- begin content ######################################################### -->

  <p class="heading">Trilinos WebSover - Expert Page</p>
        
  <!-- print form or process form? -->
  <?php if ($_POST['stage'] != 'processInput') {
    printInputForm();
  } else {
    processInputForm();
  } ?>

<!-- end content ########################################################### -->

<?php include 'common/footer.html'; ?>

<!-- ####################################################################### -->
<!-- PHP Functions
<!-- ####################################################################### -->

<!-- ####################################################################### -->
<!-- printInputForm() -->
<!-- ####################################################################### -->

<?php function printInputForm() { ?>
  
  <form action="#" enctype="multipart/form-data" method="post" name="inputForm">

    <p class="subheading">Smoother:</p>
    <table class="formTable" cellspacing="0" cellpadding="0">
      <tr><td>         
        <input type="checkbox" name="smoother[]" value="symmetric_gauss-seidel" />
      </td><td>         
        symmetric Gauss-Seidel
      </td></tr>
      
      <tr><td>         
        <input type="checkbox" name="smoother[]" value="mls" />
      </td><td>         
        MLS
      </td></tr>
    </table><br />

    <p class="subheading">Coarse Grid Solver:</p>
    <table class="formTable" cellspacing="0" cellpadding="0">
      <tr><td>         
        <input type="checkbox" name="solver[]" value="KLU" />
      </td><td>
        KLU
      </td></tr>
      
    <table class="formTable" cellspacing="0" cellpadding="0">
      <tr><td>         
        <input type="checkbox" name="solver[]" value="symmetric_gauss-seidel" />
      </td><td>         
        symmetric Gauss-Seidel
      </td></tr>
      
      <tr><td>         
        <input type="checkbox" name="solver[]" value="mls" />
      </td><td>         
        MLS
      </td></tr>
    </table><br />

    <p class="subheading">Number of Maximum Levels Allowed:</p>
    <select name="levels" size="1">
    <option>1</option>
    <option>2</option>
    <option>3</option>
    <option>4</option>
    <option>5</option>
    <option>6</option>
    <option>7</option>
    <option>8</option>
    <option>9</option>
    <option>10</option>
    </select>

    <p class="subheading">Aggregation (Coarsening) Method:</p>
    <table class="formTable" cellspacing="0" cellpadding="0">
      <tr><td>         
        <input type="checkbox" name="aggregation[]" value="uncoupled_mis" />
      </td><td>         
        Uncoupled/MIS
      </td></tr>
      
      <tr><td>         
        <input type="checkbox" name="aggregation[]" value="metis" />
      </td><td>         
        METIS
      </td></tr>
    </table><br />

    <p class="subheading">Smoothed / Unsmoothed Prolongation:</p>
    <table class="formTable" cellspacing="0" cellpadding="0">
      <tr><td>         
        <input type="checkbox" name="prolongation[]" value="smoothed" />
      </td><td>         
        smoothed
      </td></tr>
      
      <tr><td>         
        <input type="checkbox" name="prolongation[]" value="unsmoothed" />
      </td><td>         
        unsmoothed
      </td></tr>
    </table><br />

    <p class="subheading">Outer Krylov Iterative Method:</p>
    <table class="formTable" cellspacing="0" cellpadding="0">
      <tr><td>         
        <input type="checkbox" name="krylov[]" value="cg" />
      </td><td>         
        cg for symmetric problems
      </td></tr>
      
      <tr><td>         
        <input type="checkbox" name="krylov[]" value="gmres" />
      </td><td>         
        gmres for nonsymmetric problems
      </td></tr>
    </table><br />

    <p class="subheading">Maximum Number of Iterations Allowed (up to 500):</p>
    <input type="text" name="iterations" size="3" maxlength="3" />
    <br/><br/>
    
    <!-- php marker for stage in form process -->
    <input type="hidden" name="stage" value="processInput">
  
    <table cellspacing="0" cellpadding="0"><tr>
      <td style="width: 30%; padding: 5px;">
        <input type="submit" name="solveitButton" value="Solve It" style="width: 100%;" /></td>
    </tr></table>

  </form>
  
<?php } ?> <!-- printInputForm() -->

<!-- ####################################################################### -->
<!-- processInputForm() -->
<!-- ####################################################################### -->

<?php function processInputForm() {

  $error = 0;
  $errorText = "";
  
  if (!$_POST['smoother']) {
    $errorText .= "Error: please select at least one smoother.<br />\n";
    $error++;
  } if (!$_POST['solver']) {
    $errorText .= "Error: please select at least one coarse grid solver.<br />\n";
    $error++;
  } if (!$_POST['aggregation']) {
    $errorText .= "Error: please select at least one aggregation (coarsening) method.<br />\n";
    $error++;
  } if (!$_POST['prolongation']) {
    $errorText .= "Error: please select at least one prolongation method.<br />\n";
    $error++;
  } if (!$_POST['krylov']) {
    $errorText .= "Error: please select at least one outer Krylov iterative method.<br />\n";
    $error++;
  } if (!$_POST['iterations'] || !is_numeric($_POST['iterations']) || $_POST['iterations'] > 500 || $_POST['iterations'] < 1) {
    $errorText .= "Error: please enter a maximum number of iterations allowed between 1 and 500.<br />\n";
    $error++;
  }

  if ($error) {
    ?>
    <div class="errorBox">
      <?php echo $errorText; ?>
    </div>  
    <?php
  
    $_POST['stage'] = "";
    printInputForm();
    return;
  }
  
  $queryString = "?";
  $queryString .= "timestamp=".$_GET['timestamp']."&";
  $queryString .= "filex=".$_GET['filex']."&";
  $queryString .= "fileb=".$_GET['fileb']."&";
  $queryString .= "structure=".$_GET['structure']."&";
  $queryString .= "properties=".$_GET['properties']."&";
  $queryString .= "smoother=".join(",", $_POST['smoother'])."&";
  $queryString .= "solver=".join(",", $_POST['solver'])."&";  
  $queryString .= "levels=".$_POST['levels']."&";
  $queryString .= "aggregation=".join(",", $_POST['aggregation'])."&";
  $queryString .= "prolongation=".join(",", $_POST['prolongation'])."&";
  $queryString .= "krylov=".join(",", $_POST['krylov'])."&";  
  $queryString .= "iterations=".$_POST['iterations'];
  
  ?>
  <script language="JavaScript" type="text/javascript"> <!--
    window.location = 'submit.html<?php echo $queryString; ?>';
  //--> </script>
  <?php
    
} ?> <!-- processInputForm() -->