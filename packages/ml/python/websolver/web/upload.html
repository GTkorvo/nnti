<?php 
  include 'common/header.php';
  include 'util.php';
  includeStyleSheet('styles.css'); 
  setFilename('input.html');
  setTitle('Trilinos - WebSolver - Upload Page');
  setDir('./');
  include 'common/header.html';
?>

<!-- begin content ######################################################### -->

  <p class="heading">Trilinos <a href="index.html">WebSolver</a> - Upload Page</p>
        
  <!-- print form or process form? -->
  <?php if ($_POST['stage'] != 'processInput') {
    printInputForm();
  } else {
    processInputForm();
  } ?>

<!-- end content ########################################################### -->

<?php include 'common/footer.html'; ?>

<!-- ####################################################################### -->
<!-- PHP Functions
<!-- ####################################################################### -->

<!-- ####################################################################### -->
<!-- printInputForm() -->
<!-- ####################################################################### -->

<?php function printInputForm() { ?>
  
  <form action="#" enctype="multipart/form-data" method="post" name="inputForm">

    <p class="subheading">File:</p>

    <table class="formTable" cellspacing="0" cellpadding="0">
      <tr><td>
        <label for="file">Matrix or vector file:</label>
      </td><td>
        <input type="file" name="file" size="40" />
      </td></tr>
      
      <tr><td>
        <label for="filename">Filename on server:</label>
      </td><td>
        <input type="text" name="filename" size="40" />
      </td></tr>
      
      <tr><td>
        <label for="description">Description of matrix or vector:</label>
      </td><td>
        <textarea rows="4" cols="40"></textarea>
      </td></tr>
    </table><br />

    <p class="subheading">Format:</p>
    <table class="formTable" cellspacing="0" cellpadding="0">
      <tr><td>         
        <input type="radio" name="format" value="matrixMarket" />
      </td><td>         
        MatrixMarket
      </td></tr>
      
      <tr><td>         
        <input type="radio" name="format" value="harwell-boeing" />
      </td><td>         
        Harwell-Boeing
      </td></tr>
    </table><br />
    
    <!-- php marker for stage in form process -->
    <input type="hidden" name="stage" value="processInput">
    <input type="submit" name="uploadButton" value="Upload" /></td>

  </form>
  
<?php } ?> <!-- printInputForm() -->

<!-- ####################################################################### -->
<!-- processInputForm() -->
<!-- ####################################################################### -->

<?php function processInputForm() {

  $error = 0;
  $errorText = "";
  
  $timestamp = date("y-m-d_H.i.s", time());
  
  if (!is_uploaded_file($_FILES['file']['tmp_name'])) {
    $errorText .= "Error: please supply a file.<br />\n";
    $error++;
  } if (!$_POST['format']) {
    $errorText .= "Error: please select a file format.<br />\n";
    $error++;
  } 
  
  if ($error) {
    ?>
    <div class="errorBox">
      <?php echo $errorText; ?>
    </div>  
    <?php
  
    $_POST['stage'] = "";
    printInputForm();
    return;
  }
  
  return;
  
  $filename = "/people_old/trilinos_www/data";
  move_uploaded_file($_FILES['file']['tmp_name'], $aFilename);
  chmod($aFilename, 0664);
  
  if (is_uploaded_file($files['fileX']['tmp_name'])) {
    $xFilename = "/people_old/trilinos_www/htdocs/runs/$timestamp/x_file";
    move_uploaded_file($_FILES['fileX']['tmp_name'], $xFilename);
    chmod($xFilename, 0664);
    $xFilePresent = "yes";
  } else {
    $xFilePresent = "no";
  }
  
  if (is_uploaded_file($files['fileB']['tmp_name'])) {
    $bFilename = "/people_old/trilinos_www/htdocs/runs/$timestamp/b_file";
    move_uploaded_file($_FILES['fileB']['tmp_name'], $bFilename);
    chmod($bFilename, 0664);
    $bFilePresent = "yes";
  } else {
    $bFilePresent = "no";
  }
  
  $queryString = "?";
  $queryString .= "timestamp=$timestamp&";
  $queryString .= "filex=$xFilePresent&";
  $queryString .= "fileb=$bFilePresent&";
  $queryString .= "structure=".$_POST['structure']."&";
  $queryString .= "properties=".$_POST['properties'];
  
  if ($_POST['uploadButton']) { ?>
    <script language="JavaScript" type="text/javascript"> <!--
      window.location = 'submit.html<?php echo $queryString; ?>';
    //--> </script>
  <?php }
    
} ?> <!-- processInputForm() -->