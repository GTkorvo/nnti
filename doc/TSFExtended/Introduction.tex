\section{Introduction}

The Trilinos~\cite{ref:trilinos} 
family of solver components provides an extensive set of
tools for building high-performance linear and nonlinear solvers. To 
enable use of Trilinos in advanced solver development
and facilitate interoperability
with other packages, a set of high level interfaces called the Trilinos
Solver Framework~\cite{ref:TSF} (TSF) was developed. 
TSF provided
Trilinos with 
new capabilities such as composable operators and block operators and vectors, 
and furthermore provided a convenient, high-level but nonetheless efficient
interface using deferred-evaluation overloaded operators.  The design of 
TSF leaned heavily on the groundbreaking
Hilbert Class Library (HCL) of Gockenbach and Symes~\cite{ref:hcl}, and as 
such inherited many of the strengths and weaknesses of that design. 
In particular, both HCL and TSF attempted to define an exhaustive interface
for vectors, which requires modification to the core vector interface
as new methods are needed. In an environment where multiple 
vector implementations must be supported and new solver and
optimization algorithms frequently require new, exotic methods,
maintaining an exhaustive
interface becomes akin to the punishment of Sisyphus.

A scalable way out of this difficulty was 
proposed by Bartlett {\it et. al.}~\cite{ref:rtop_toms}.
Rather than incorporating all
required methods in a vector interface, define a minimal interface
with a {\it single} method: a call to a functor for arbitrary redution
and transformation operations (RTOps). In this way one can
extend the capability of vectors by implementing new RTOps and need never
modify any vector implementations.  

A further difficulty with the original implementation of TSF was that the
high-level reference-counted 
handles were intimately built into the design, occasionally
posing interoperability problems with systems using other memory management
models. 

To address these difficulties, we have decided to refactor TSF for 
maintainability and interoperability while maintaining as much as possible
of the original capabilities. TSF contained many utilities, which
have since been moved to Teuchos, the central Trilinos utilities
package. An important aspect of the refactoring is to draw
a distinction between the capabilities needed by developers of abstract
numerical algorithms (ANA) and those needed by applications developers.
Most Trilinos solver 
developers will see only the interface required for ANA, thus
we have partitioned the ``core'' ANA interface into a distinct package
called TSFCore, described in a separate paper~\cite{ref:TSFCore}.
This paper is concerned with the ``extended'' capabilities of TSF, such
as the application interface, block and composed operators, operator
overloading, and advanced preconditioning.





