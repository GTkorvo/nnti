\documentclass[pdf,ps2pdf,11pt]{SANDreport}
\usepackage{pslatex}
%Local stuff
\usepackage{graphicx}
\usepackage{latexsym}
\usepackage[all]{draftcopy}
\input{rab_commands}


\raggedright

% If you want to relax some of the SAND98-0730 requirements, use the "relax"
% option. It adds spaces and boldface in the table of contents, and does not
% force the page layout sizes.
% e.g. \documentclass[relax,12pt]{SANDreport}
%
% You can also use the "strict" option, which applies even more of the
% SAND98-0730 guidelines. It gets rid of section numbers which are often
% useful; e.g. \documentclass[strict]{SANDreport}

% ---------------------------------------------------------------------------- %
%
% Set the title, author, and date
%

\title{\center
ASC Vertical Integration Milestone
}
\author{
Roscoe Bartlett (Technical PI) \\
Scott Collis (Management PI) \\
Todd Coffey \\
David Day \\
Mike Heroux \\
Rob Hoekstra \\
Russell Hooper \\
Roger Pawlowski \\
Eric Phipps \\
Denis Ridzal \\
Andrew Salinger \\
Heidi Thornquist \\
Jim Willenbring \\
Sandia National
Laboratories\footnote{ Sandia is a multiprogram laboratory operated by Sandia
Corporation, a Lockheed-Martin Company, for the United States Department of
Energy under Contract DE-AC04-94AL85000.}, Albuquerque NM 87185 USA
}

% ---------------------------------------------------------------------------- %
% Set some things we need for SAND reports. These are mandatory
%
\SANDnum{SAND2007-xxx}
\SANDprintDate{??? 2007}
\SANDauthor{
Roscoe Bartlett (Technical PI) \\
Scott Collis (Management PI) \\
Todd Coffey \\
David Day \\
Mike Heroux \\
Rob Hoekstra \\
Russell Hooper \\
Roger Pawlowski \\
Eric Phipps \\
Denis Ridzal \\
Andy Salinger\\
Heidi Thornquist \\
Jim Willenbring
}

% ---------------------------------------------------------------------------- %
% The following definitions are optional. The values shown are the default
% ones provided by SANDreport.cls
%
\SANDreleaseType{Unlimited Release}
%\SANDreleaseType{Not approved for general release}

% ---------------------------------------------------------------------------- %
% The following definition does not have a default value and will not
% print anything, if not defined
%
%\SANDsupersed{SAND1901-0001}{January 1901}

% ---------------------------------------------------------------------------- %
%
% Start the document
%
\begin{document}

\maketitle

% ------------------------------------------------------------------------ %
% An Abstract is required for SAND reports
%

%\clearpage

%
\begin{abstract}
%

The FY2007 ASC Level-2 Vertical Integration Milestone effort developed the
vertical integration of many new advanced Trilinos solver packages to build
new predictive solution capabilities.  These where demonstrated on several
relevant problems including QASPR-related semiconductor problems modeled in
Charon and a MEMS design problem in Aria/SIERRA.  All of the objectives of the
milestone have been meet and exceeded in several cases.  In addition to the
Trilinos-specific accomplishments and the demonstration calculations, the
milestone work has also helped us realize a new vision for a deeper level of
collaboration between solver developers and application developers which
benefits everyone involved.  The bridge for this deeper collaboration is based
on the foundation of nightly building and testing of the development versions
of the application code (e.g.\ Charon) and Trilinos.

% 2007/08/23: rabartl:  We don't need the text below and it makes the abstract
% go past the cover page.  That is what the executive summary is for.
%
%We have reached several important conclusions after completing the milestone
%work.  First, Solving complex numerical problems to the highest quality with
%the greatest efficiency requires the vertical integration of many different
%types of advanced numerical algorithms that can be tailored to the specific
%problem.  Second, nightly building and testing of an application code and
%Trilinos brings algorithm developers and application developers closer
%together -- exchanging ideas and concerns -- and makes Trilinos a more
%customer focused effort while still helping drive publishable numerical
%algorithm solver research and reduces barriers for new algorithms to have
%impact through production application codes.  Several other important
%conculsions are also articulated.

%
\end{abstract}
%

% ------------------------------------------------------------------------ %
% An Acknowledgement section is optional but important, if someone made
% contributions or helped beyond the normal part of a work assignment.
% Use \section* since we don't want it in the table of context
%
%\clearpage
%\section*{Acknowledgment}
%
%
%The format of this report is based on information found
%in~\cite{Sand98-0730}.

% ------------------------------------------------------------------------ %
% The table of contents and list of figures and tables
% Comment out \listoffigures and \listoftables if there are no
% figures or tables. Make sure this starts on an odd numbered page
%
\clearpage
\tableofcontents
\listoffigures
%\listoftables

% ---------------------------------------------------------------------- %
% An optional preface or Foreword
%\clearpage
%\section{Preface}
%Although muggles usually have only limited experience with
%magic, and many even dispute its existence, it is worthwhile
%to be open minded and explore the possibilities.

% ---------------------------------------------------------------------- %
% An optional executive summary

\clearpage

\section{Executive Summary}

%
%... In some ways, the most important part of the document as I can imagine 
%... that it might be all that some manager read.
%

{}\noindent\textbf{Overview:} The ASC FY2007 ASC Vertical Integration
Milestone has demonstrated a full vertical integration of numerical algorithms
in Trilinos ranging from basic parallel linear algebra all the way all the way
up through transient solvers and simulation-constrained optimization in a plug
an play, high-performance manner.  We are targeting using optimization methods
with Charon to do automatic parameter estimation against data in a fast and
robust way.  This work has provided a significant new capability and
demonstrates the power of giving advanced algorithms better access to
production application codes and in providing the software engineering
infrastructure to maintain the new capabilities in the long term.

{}\noindent\textbf{Milestone Completion:} We have accomplished all of our
promised objectives and have exceeded our mandate in several areas.  This new
capability has been released as part of Trilinos 8.0.

{}\noindent\textbf{Selected Accomplishments:} Some of the more noteworthy
accomplishments achieved during the milestone work include:\\[0.5ex]

\begin{enumerate}

{}\item Implemented full vertical-integration of Trilinos capabilities using
standard Thyra interfaces including: distributed, parallel data-structures;
linear-solvers; precondtioners; nonlinear-solvers; eigen-solvers; automatic
differentiation; transient solvers; and optimization solvers.

{}\item Demonstrated these capabilities using the ASC Charon application with
application to QASPR semiconductor simulations including:

  \begin{enumerate}
  
  {}\item Transient forward simulation,
  
  {}\item Transient forward sensitivity analysis, and
  
  {}\item Steady-state current-matching parameter estimation problem.
  
  \end{enumerate}
  
{}\item As additional evidence of vertical-integration and to highlight that
these algorithms tools are ready and available for a wide range of ASC
applications, we also
  
  \begin{enumerate}
  
  {}\item Block eigensolves for a reacting flow problem in Charon that
  utilized at least eight distinct Trilinos packages.
  
  {}\item Design optimization of a MEMS actuator using Aria/SIERRA.
  
  \end{enumerate}
  
{}\item In addition to these demonstrations, this milestone helped to highlight
and address many of the challenges of injecting advanced algorithms into a
production application.

\end{enumerate}

% ---------------------------------------------------------------------- %
% An optional glossary. We don't want it to be numbered
%\clearpage
%\section*{Nomenclature}
%\addcontentsline{toc}{section}{Nomenclature}
%\begin{itemize}
%\item[alohomora]
%spell to open locked doors and containers
%\end{itemize}

% ---------------------------------------------------------------------- %
% This is where the body of the report begins; usually with an Introduction
%

\SANDmain % Start the main part of the report

%
\section{Introduction}
%

Many challenges exist in using cutting-edge research-driven numerical
algorithms and solvers to impact challenging production-quality applications.
Even more challenges exist in allowing production-quality applications to help
drive the research of numerical algorithms in a significant way.  Further, the
challenges become more daunting when considering new predictive simulation
tools like invasive uncertainty quantification (UQ), sensitivity analysis, and
optimization methods.  Addressing these challenges requires dedicated and
sustained efforts in mathematical abstraction and design, algorithms design,
application program structuring and flexibility, and ultimately good
object-oriented software engineering.  The FY2007 ASC Level-2 Algorithms
Vertical Integration Milestone has addressed many of these challenges by
demonstrating the vertical integration of many different types of numerical
algorithms in Trilinos [???] and assimilating these algorithms with the
application code Charon [???] in a way that can serve as a model for other
algorithms-applications collaborations.

On the numerical algorithms side, it is non-trivial to develop and vertically
integrate state-of-the-art massively parallel numerical algorithms ranging all
the way from basic linear algebra data-structures through linear and nonlinear
solvers up to transient solvers and optimization.  Each of these different
numerical algorithm components is developed by a different team of experts to
achieve highest level of quality in the implemented algorithms in a way that a
single team of non-expert developers can not match.  This effort is further
complicated by the stringent parallel scalability requirements that are part
of capability computing [???].

To address the vertical integration problem, a major thrust of this milestone
was to further develop and demonstrate the Thyra interface layer in Trilinos
as a way to seamlessly integrate and plug-and-play different implementations of
various numerical solver components, each developed by different teams of
expert algorithm developers.  In short, the goal of Thyra within Trilinos is
to cleanly support nearly any vertical integration of numerical solvers that
makes sense mathematically in a scalable and maintainable way.

To demonstrate this vertical interoperability and integration, we focused on
the Charon [???] application code with an emphasis on semiconductor problems
related to the QASPR [???] program.  In particular, we targeted sensitivity
analysis and parameter estimation optimization problems [ToDo: rjhokes: Plese
some something more about this!].  As an indication of the power and
generality of these algorithms, we also demonstrated some of the developed
capabilities on reacting flow problems in Charon and on coupled
thermal/electrical/structural problem in Aria/SIERRA.

The bridge between numerical algorithms and application codes is software.
Numerical algorithms must be implemented in software and great effort and care
is required to achieve maximum robustness, speed, and scalability.
Integrating numerical software into application codes is often difficult and
tedious work and keeping the numerical solver software and the application
software up to date with each other is critical to allow the flow of ideas and
capabilities back and forth between algorithm developers and application
developers.  Good software engineering practices are needed to keep the
software ``bridge'' between algorithms and applications alive and productive
for all involved.

During the course of this milestone work, we have shown how to scalably manage
the vertical integration of advanced numerical algorithms from basic linear
algebra, linear solvers, nonlinear solvers, stability and bifurcation methods,
automatic differntiation, transient solvers, and simulation-constrained
optimization.  We have demonstrated various instances of vertically integrated
solvers with several different problems modeled in production applications.
We have also developed a software integration process and infrastructure
between Charon and Trilinos through which algorithm developers and application
developers can more closely work together the yield faster, more robust, and
better tailored numerical algorithms to meet the specific needs of important
application customers while at the same time stimulating publishable numerical
algorithm research.

%
\section{Trilinos algorithms and vertical integration with Thyra}
%

A primary goal of this work was to drive the development and vertical
integration of the algorithms in the packages Belos (block linear solvers),
Anasazi (block eigensolvers), Rythmos (time integrators), and MOOCHO
(optimization) in order to implement advanced solver/analysis/optimization
capabilities.  In addition, we incorporated several other Trilinos packages
including Epetra (linear algebra data structure packages), Ifpack (incomplete
factorization preconditioners), ML (multi-level algebraic preconditioners),
Amesos (direct sparse solvers), NOX (nonlinear equation solvers), LOCA
(stability and bifurcation methods), Sacado (automatic differentiation) and
more.

{\bsinglespace
\begin{figure}[p]
\begin{center}
%\fbox{
\includegraphics*[angle=270,scale=0.90
]{VerticalPackageIntegration}
%}
\end{center}
\caption[Six different levels of vertical integration in time integration]{
\label{fig:VerticalPackageIntegration}
Example of six different levels of vertical integration that exist in a
transient ODE/DAE solver in Rythmos.}
\end{figure}
\esinglespace}

Vertical integration of numerical algorithms refers to the nesting of
numerical solvers within each other to enable the construction of
sophisticated multi-component solver capabilities.  For example, a modularized
ODE/DAE transient solver such as is implemented Rythmos, shown in
Figure~\ref{fig:VerticalPackageIntegration}, demonstrates at least six
different levels of vertical algorithm integration.  It is critically
important that these types of modular solvers be constructed in a way that
allows for almost any individual algorithm/solver component to be swapped out
for a version better suited to a given problem.  For example, while an
implicit backward Euler time stepper may be appropriate for one particular
class of problems, a higher-order implicit time stepper, such as a
variable-order variable step size BDF method, may be superior for another
important class of problems.  The same need for flexibility and modularity is
required for the selection of preconditioners, linear solvers, and other
numerical algorithm components.  Without this type of flexibility, application
developers may be justified in writing their own suboptimal algorithms due to
an inability to change an inappropriate component of a more general solver
(there are many examples of this in production codes).  There was one example
where a production circuit simulation application code was not able to use an
existing well known time integration solver due to the inability to redefine
the nonlinear solver used for the time step equation.

% SSC:  I like this statement, but you should be able to cite particular 
% examples (without mentioning names).

% rabartl: Todd, can you provide some concrete exmaples where you want
% one particular type of integration method in one case, but not another?

Integrating independently developed numerical algorithms and software in an
efficient and manageable way requires the development of standard
object-oriented interfaces.  Typical approaches for combining $N$ different
numerical solver algorithms together may require up to $N^2$ different 1-to-1
specific connections in the worst case.  Standard interfaces break the
non-scalable $N$-to-$N$ dependencies between different numerical software
components into separate scalable 1-to-$N$ dependencies.  An example if this
is described later in the context of the ModelEvaluator interface.

% SSC:  you need to define N and M in this context to make this more clear.
% Ross, don't you have a reference (paper or SAND report) that discusses this.  
% If so, you should cite that the include that as part of the milestone evidence.
% even if it was not published this year (we have known to been working on this
% milestone for more than 1 year :)

% rabart:  I don't have a handly written reference to describe this problem,
% only presentations up to this point.

Standard interfaces for these types of numerical algorithms have been developed
and refined in the Trilinos package {}\textit{Thyra}\footnote{The word
{}\textit{Thyra} means ``interface'', or ``grand entrance'' in Greek.}.  Thyra
is comprised of a layered set of abstract C++ interfaces to linear operators
and vectors, preconditioners and linear solvers, an interface to nonlinear
models called the ModelEvaluator, and a nonlinear equation solver interface.
Layered on top of the Thyra interfaces are Rythmos interfaces defining a
number of higher-level abstractions for time stepping and time integration
algorithms.  All of these interfaces are built on the concept of Abstract
Numerical Algorithms (ANA) where only the essential mathematical properties of
the objects are considered without any implementation specific details.  This
high-level ANA approach allows a for a level of generality, reuse, and
efficiency that is not possible with other types of approaches.

% SSC:  this is begging for a citation here...

% rabartl: I am not sure what reference I would give here ...


{\bsinglespace
\begin{figure}
\begin{center}
%\fbox{
\includegraphics*[angle=270,scale=0.90
]{ModelEvaluator}
%}
\end{center}
\caption[Thyra ModelEvaluator and linear solver interfaces]{
\label{fig:ModelEvaluator}
This figure shows the Thyra ModelEvaluator interface and the Thyra linear
solver interface and how they relate to nonlinear abstract numerical
algorithms and nonlinear applications.  This demonstrates the decoupling and
scalability of the Thyra standard interface approach. }
\end{figure}
\esinglespace}

Of particular significance to this milestone is the use of the Thyra nonlinear
ModelEvaluator interface and supporting software.  Through a single interface,
a variety of nonlinear problems are presented to NOX, LOCA, Rythmos and MOOCHO
using both Charon and Aria/SIERRA as shown in Figure~\ref{fig:ModelEvaluator}.
The {}\textit{Stratimikos} component shown in Figure~\ref{fig:ModelEvaluator}
is a Trilinos package built on the Thyra preconditioner and linear solver
interfaces that provides unified parameter-driven access to a great number of
preconditioner and linear solver capabilities in Trilinos.  The ModelEvaluator
and Stratimikos approach is a clear demonstration of breaking up N-to-M
dependencies which results in scalable 1-to-N and 1-to-M dependencies.  Adding
a new nonlinear ANA solver only requires a single set of Thyra interfaces and
then this solver can be used by the entire set of application codes that
support the needed functionality.  Likewise, an application just needs to
implement the single ModelEvaluator interface, and then it can access all of
the various supported nonlinear solvers.  Finally, a new preconditioner or
linear solver can be wrapped under Stratimikos and then be available to all
applications and nonlinear ANAs that support the ModelEvaluator interface.
This type of reuse and interoperability for massively parallel nonlinear
applications and algorithms has never been achieved to this degree before and
this type of reuse and interoperability will increase in the future.

This milestone work clearly highlights the effectiveness of the Thyra
interface layer and ANA approach as demonstrated by the variety of the
different types of vertically integrated solver configurations that were
achieved and the types of numerical problems that were solved.  Specific
examples of different vertical solver integrations and problems solved are
given in Section {}\ref{sec:demonstration}.


%
\section{Charon/QASPR}
%

The Qualification Alternatives to the Sandia Pulsed Reactor (QASPR) program is
focused on future qualification of electrical weapons systems in short pulse
neutron environments (SPNE).  With the shutdown of the SPR III reactor in
2006, full system failure tests in SPNE are no longer possible.  Replacement
of this qualification testing is critical to the future of nuclear weapons
certification.  The QASPR program is targeting this gap with a combination of
testing at alternative test facilities, such as the Annular Core Research
Reactor (ACRR) and the Ion Beam Laboratory (IBL), with high fidelity
predictive computational modeling.  As well as supporting qualification, these
tools will increase the designer~s capability to develop robust systems during
the early stages of systems development.

The ASC Charon semiconductor device simulator is a finite element tool capable
of simulating high fidelity models of stockpile devices using large scale ASC
platforms for unprecedented scales and fidelities of transient displacement
damage, due to neutrons, in stockpile devices such as power bipolar junction
transistors.  This capability was developed using predictive fundamental
physics models developed at SNL through experiment and atomistic modeling
(Density Functional Theory and Molecular Dynamics) and massively parallel
algorithmic technology in the ASC Trilinos solver libraries and the ASC Nevada
finite element framework.

A critical aspect of the QASPR problems of interest is the refinement of
physics models for unirradiated and irradiated devices in comparison to
experimental data.  Two key examples in the current QASPR process include: 1)
calibration of the device doping profiles based on secondary ion mass
spectrometry, which has a substantial absolute error for density
(approximately a factor of 2), and electrical characterization of the device;
2) calibration of displacement defect physics parameters, which have an order
of magnitude uncertainty, against transient pulse electrical characterization
experiments.  Currently, these ``calibrations'' are accomplished with
substantial manual effort and resources involving hundreds to thousands of
calculations.  The new algorithmic technologies integrated in Charon show
great promise in their ability to efficiently and robustly solve these
problems with dramatically less manpower and computational resources.

%
\section{Application and Trilinos development nightly integration testing}
%

Through the course of the milestone work, we found that in order to keep
moving forward and avoid backslides in capability (which happened early on),
we where forced to implement nightly building and testing of the development
versions of Charon and Trilinos.  Every night, we take what is in the Charon
and Trilinos development repositories and build the combined Charon \&
Trilinos application and run a large set of regression tests.  In the time
since we started nightly building and testing, the number of tests in the
Charon test suite has gone up from under 50 to over 100, and {\em 30 of the
new tests are directly related to this milestone work.}

In the execution of this nightly building and testing process, we have learned
many things about how to do continuous integration [???] of an application and
algorithms (Trilinos) and we have realized many important unplanned benefits
and will reap many more benefits in the future if this process is maintained
and extended.  There are both production-related benefits and research-related
benefits that help both the application developers and the algorithm
developers to achieve their goals.  On the research side, this significantly
reduces the overhead required for algorithm developers to try their algorithms
out on production quality problems.  Developing a numerical solver with a
production problem exposes the algorithm developer to a whole host of issues
(e.g.\ poor scaling, ill-conditioning, difficult convergence, etc.) that are
hard to replicate in model problems.  On the production side, constant
integration insures that the application and Trilinos are always up to date
and satisfying the application's requirements.  Therefore, when it is time for
a release, only a final set of acceptance tests are required and then the
codes can be branched and released shortly after.  This helps to reduce a
whole host of risks such as slipped schedules and broken
features\footnote{Also known as regressions}.

% SSC:  this prior paragraph may benefit from a few more concrete examples
% to help bolster the claims.

% rabartl: Okay, here are a few examples ...

We have seen several different scenarios where this nightly building and
testing infrastructure would have facilitated collaboration between
application and algorithm developers for the advantage of both.

For example, suppose an application developer is running a new problem and
discovers some strange behavor from a numerical solver.  The algrithm
developer may look at the results and speculate what the cause of the behavior
might be or if a few different variation of the algorithm might help.
However, if the algorithm devleoper is stuck having to use a released version
of Trilinos, it will be more difficult to make any major changes in order to
investigate the behavior.  Also, there may already be improvements made to the
algorithm in the development branch of Trilinos that may be able to address
the problem.  Without the infrastructure of nighlty building and testing, it
may not be cost effective or practical to bring the development versions of
the application and Trilinos up to date in order to try the updated algorithm.
The algorithm and application developers may have to wait until the next major
release of Trilinos before the new algorithms can be tried.  This time delay
works to no ones advantage and can kill the collaboration.  With nightly
building and testing in place, an easy path for collaboration is maintained
where the Trilinos algorithm developer can try their latest and greatest
algorithms on these types of challenging production problems and the
information learned from trying to solve these production problems can feed
back into algorithm development.  To some extent, this back and forth already
happens but without a foundational process in place to streamline it, the back
and forth flow is restricted.

Bottom line, nightly building and testing of an application code and Trilinos
brings algorithm developers and application developers closer together --
exchanging ideas and concerns -- and makes Trilinos a more customer focused
effort while still helping drive publishable numerical algorithm solver
research and reduces barriers for new algorithms to have impact through
production application codes.

% SSC:  I think that this is very important and should be touted as a major 
% accomplishment of ths milestone!


%
\section{Demonstration solver vertical integrations and calculations}
\label{sec:demonstration}
%

While many different numerical solver configurations where used to solve a
variety of different numerical problems in Charon and Aria during the
milestone work, some of the more noteworthy examples\footnote{Each of these
examples are noteworthy for different reasons.} are given below.  For each
example, the list of vertically integrated algorithm packages that where
linked together to solve the problem are given.  Note that the Thyra package
was used in all cases as the standard interface glue to pull these algorithm
packages together.

%
\subsection{Steady-state semiconductor current-matching parameter
estimation problems}
%

{}\noindent\textit{Vertically integrated packages:} MOOCHO, Stratimikos,
Belos, Ifpack, Thyra, and Epetra

{\bsinglespace
\begin{figure}
\begin{center}
%\fbox{
\includegraphics*[angle=0,scale=0.80,width=0.50\linewidth
]{multiPointFit}
%}
\end{center}
\caption[Multipoint current-matching parameter estimation solution against experimental data]{
\label{fig:multiPointFit}
This figure illustrates how multipoint optimization can be used to optimize
system parameters so that a {\em curve} of responses can best be matched. In
this case, $12$ steady-state current predictions, running in paralllel, were
fit to the experimental data.}
\end{figure}
\esinglespace}

We solved both single-point and multi-point inverse optimization problems for
the QASPR semiconductor model 5614.  Here, we used MOOCHO to solve a
simulation-constrained least-squares optimization problem to minimize the
deviation between the simulated current through the device and the target
current by manipulating the poorly know defect reaction parameters.  We showed
significant improvement in accuracy and speedup over non-invasive block-box
methods.

%[ToDo: rabartl: We have not really compared to the non-invasive
%block-box methods but we could if we wanted too ... Russell may be able to do
%such a comparison for the MOOCHO/Aria problem].

% 2007/08/22: rabartl: Right now, we can't really claim any speedup using
% Belos.  This may be fixed in time for the milestone completion, but for now
% I will ommit this.

%In addition, the forward sensitivity
%method using pseudo-block GMRES in Belos showed superior performance to
%AztecOO (the current production iterative linear solver in Trilinos) [ToDo:
%rabartl: We need to modify the setup of this model and fix some problems in Belos
%to really show this].

% SSC:  you need to justify the assertion that you achieved significant improvements
% rabartl:  I commented this out above.

The multi-point algorithm allows parameters to be matched over the whole
current-voltage curve simultaneously, with excellent scalability by using
another dimension of parallelism over the multiple data points.  This required
development in EpetraExt and modifications to the Nevada/Charon code, where
multiple instances of the code run simultaneously with partitioned MPI
Communicators, while the linear algebra and optimization algorithms operate on
a global MPI communicator.

%[ToDo: rabartl: give the form of the optimization problem and give the initial
%and final objective function values]

% SSC:  in the description below, more is required regarding not being able to 
% solve this problem for the ``physically'' relevant parameters.  In particular,
% these results may suggest that what s thought to be the relevant parameters 
% are infact not.  Likewise, there could be a bias in the experiemental results
% that is not accounted for.  The main point is that the milestone provides the
% tooles and capabilties to now explore these questions which could not be 
% readily done before.

% rabartl: I agree, and I have added text to make these points more clear ...

As seen in Figure {}\ref{fig:multiPointFit}, we were successful in having the
multipoint algorithm find the optimal parameter value so that a curve of 12
points would best match the experimental data. Since the application for this
problem specification runs well in serial, this was run on 12 processors of
Thunderbrid for near-optimal scalability.  The results shown were computed by
altering the total amount of radiation damage, and then optimally fit using
the voltage at the second contact as the optimization parameter.

Unfortunately, we were not able to match all experimental data to high
precision by just using the most physically relevant parameters that govern
the defect physics as identified by the QASPR modelers.  While we where not
able to provide a definitive proof of the cause, single-point current-matching
numerical experiments suggest that many of these experimental states are
simply not reachable given the other model operating parameters which are
supposed to be known to high precision.  This suggests that either there was
experimental error, or the other operating parameters did not really match the
physical system, or the model was incomplete in some way.  The main point is
that while we were not able to diagnose the cause of the problem, the
milestone has developed some of the tools needed to help answer these
questions in the future.

% 2007/08/23: rabartl: Below, I think that I am making a good point but I am
% not sure that it belongs in the ``demonstation'' section.

On interesting output of this work was the behavior of the optimization
algorithms in MOOCHO and for just forward solver algorithms.  It turned out
that the radiation defect physics steady-state semiconductor model caused many
convergence challenges for the algorithms.  In some cases, even small
perturbations in the defect reaction parameters would cause the forward
Newton's method to fail to just re-converge the state equations and the
optimization algorithms in MOOCHO suffered similar convergence difficulties.
A problem of this difficulty provides an exciting opportunity for further
research into globalization methods for simulation-constrained optimization.
Typically, numerical algorithm researches are resigned to develop their
algorithms on ``model'' problems that they try to make difficult but it is
hard to reproduce the kinds of unexpected difficulties that are manifested in
real production-quality applications such as this.  Now that these test
problems are part of the Charon test suite, they can be preserved and will
provide easy access for further algorithm research.  Without nightly testing,
it is our past experience that these type of interesting test problems always
fall away due to code and other changes that break the connection between the
production application and the numerical algorithm software.

% SSC:  This transient forward run is critical to the milestone

%
\subsection{Transient QASPR semiconductor forward simulation}
%

{}\noindent\textit{Vertically integrated packages:} Rythmos, NOX, Stratimikos,
Belos, Ifpack, Thyra, and Epetra

We used a high-order accuracy-controlling implicit BDF integrator algorithm in
Rythmos (along with other mentioned vertically integrated packages) to solve
forward simulation problems for the 2-dimensional prompt neutron physics
QASPR 2n2222 semiconductor model on 1024 nodes of Tbird.  This capability
demonstrates the high accuracy time integration capability for a critical
QASPR problem.  Robust and efficient solution of this transient simulation
allows us to quantify the effects of prompt neutron irradiation for a key
stockpile device in direct support of the QASPR mission.  A 1.3 million element
mesh is used with a total of approximately 60 million unknowns leading to
the need for massively parallel scalability for all algorithmic capabilities
being used from Trilinos and the vertical integration effort. 

[ToDo: tscoffe or etphipps or rjhoeks: a) Expand the description of this
problem, b) create some placeholder for results in lue of results, c) Actually
get the results and fill in what this demonstrates!].

% RJH:  these calculations will probably be run by 9/10

% SSC:  this is very important too...

%
\subsection{Transient QASPR semiconductor sensitivities}
%

{}\noindent\textit{Vertically integrated packages:} Rythmos, NOX, Stratimikos,
Belos, Ifpack, Thyra, and Epetra

We used the new forward sensitivity solver in Rythmos to demonstrate the
calculation of current sensitivities with respect to defect reaction
parameters.  The Rythmos/Charon implementation produced the sensitivities
faster with greater accuracy then was previously possible using non-invasive
block-box finite-difference methods.

The parameters of interest in this calculation are physics parameters associated
with damage mechanisms in the device which dramatically impact the transient
electrical performance of the bipolar junction transistor.  As one of the 
devices used in the stockpile, it is critical to characterize its performance.
Without underground testing and now the decommisionning of fast pulse
neutron facilities such as the Sandia Pulsed Reactor (SPR), a combination of
alternate experimental data such as ion beam data and predictive modeling
is critical to the future of weapons systems qualification.  The nominal values
of these parameters have an order of magnitude uncertainty making best fit
plus uncertainty untenable for the customer.  Through optimization and calibration
of the Charon model to experimental data, the uncertainty in these parameters
can be substantially reduced.  This transient sensitivity analysis not only
facilitates gradient based optimization technology but also allows detailed
analysis of the mechanisms and their importance in relation to the critical
device performance metrics guiding future improvements to the model.

[ToDo: rjhoeks: Please add some detail about the nature of these parameters]

[ToDo: rabartl: We don't have these results yet but this is my number one
technical goal leading up to the end of the milestone].

{\bsinglespace
\begin{figure}[p]
\begin{center}
%\fbox{
\includegraphics*[width=5in]{sensitivities_hist_report}
%}
\end{center}
\caption[Transient current sensitivities at several times]{
\label{fig:SensitivitesHist}
Transient current sensitivities at several times.}
\end{figure}
\esinglespace}

{\bsinglespace
\begin{table}[htb]
\label{table:ParameterKey}
\caption[Key to transient sensitivity parameters]{
Key to transient sensitivity parameters}
\begin{center}
\begin{tabular}{|r|l|c|r|l|c|}
\hline 
\multicolumn{6}{|c|}{Reaction Cross-Section Parameters} \\
\hline
\multicolumn{1}{|c|}{Index} & 
\multicolumn{1}{c|}{Value} & 
\multicolumn{1}{c|}{Reaction} & 
\multicolumn{1}{c|}{Index} & 
\multicolumn{1}{c|}{Value} & 
\multicolumn{1}{c|}{Reaction} \\ 
\hline\hline
1  & 3.0e-16 & $e^- + V^-\rightarrow V^{--}$  & 15 & 1.8e-13 & $e^+ + V^- \rightarrow V^0$     \\
2  & 3.0e-16 & $V^{--} \rightarrow e^- + V^-$ & 16 & 1.8e-13 & $V^0 \rightarrow e^+ + V^-$     \\
3  & 1.8e-14 & $e^- + V^0 \rightarrow V^-$    & 17 & 3.0e-15 & $e^+ + V^0 \rightarrow V^+$     \\
4  & 1.8e-14 & $V^- \rightarrow e^- + V^0$    & 18 & 3.0e-15 & $V^+ \rightarrow e^+ + V^0$     \\ 
5  & 3.0e-14 & $e^- + V^+ \rightarrow V^0$    & 19 & 3.0e-16 & $e^+ + V^+ \rightarrow V^{++}$  \\
6  & 3.0e-14 & $V^0 \rightarrow e^- + V^+$    & 20 & 3.0e-16 & $V^{++} \rightarrow e^+ + V^+$  \\
7  & 3.0e-14 & $e^- + V^{++} \rightarrow V^+$ & 21 & 3.0e-16 & $e^+ + B^- \rightarrow B^0$     \\
8  & 3.0e-14 & $V^+ \rightarrow e^- + V^{++}$ & 22 & 7.5e-14 & $B^0 \rightarrow e^+ + B^-$     \\
9  & 3.0e-16 & $e^- + P^+ \rightarrow P^0$    & 23 & 3.0e-14& $e^+ + PV^- \rightarrow PV^0$   \\
10 & 1.5e-13 & $P^0 \rightarrow e^- + P^+$    & 24 & 3.0e-14 & $PV^0 \rightarrow e^+ + PV^-$   \\
11 & 3.0e-15 & $e^- + PV^0 \rightarrow PV^-$  & 25 & 1.0 & $V^{--} + P^+ \rightarrow PV^-$ \\
12 & 3.0e-15 & $PV^- \rightarrow e^- + PV^0$  & 26 & 1.0 & $V^- + P^0 \rightarrow PV^-$    \\
13 & 3.0e-14 & $e^+ + V^{--} \rightarrow V^-$ & 27 & 1.0 & $V^- + P^+ \rightarrow PV^0$    \\
14 & 3.0e-14 & $V^- \rightarrow e^+ + V^{--}$ & 28 & 1.0 & $V^0 + P^0 \rightarrow PV^0$    \\
\hline
\end{tabular}
\begin{tabular}{|r|l|c|r|l|c|}
\hline 
\multicolumn{6}{|c|}{Reaction Activation Energy Parameters} \\
\hline
\multicolumn{1}{|c|}{Index} & 
\multicolumn{1}{c|}{Value} & 
\multicolumn{1}{c|}{Reaction} & 
\multicolumn{1}{c|}{Index} & 
\multicolumn{1}{c|}{Value} & 
\multicolumn{1}{c|}{Reaction} \\ 
\hline\hline
29 & 0.09 & $V^{--} \rightarrow e^- + V^-$ & 35 & 1.03 & $V^- \rightarrow e^+ + V^{--}$ \\
30 & 0.40 & $V^- \rightarrow e^- + V^0$    & 36 & 0.72 & $V^0 \rightarrow e^+ + V^-$    \\
31 & 1.07 & $V^0 \rightarrow e^- + V^+$    & 37 & 0.05 & $V^+ \rightarrow e^+ + V^0$    \\
32 & 0.99 & $V^+ \rightarrow e^- + V^{++}$ & 38 & 0.13 & $V^{++} \rightarrow e^+ + V^+$ \\ 
33 & 0.045 & $P^0 \rightarrow e^- + P^+$    & 39 & 0.045 & $B^0 \rightarrow e^+ + B^-$    \\
34 & 0.44 & $PV^- \rightarrow e^- + PV^0$  & 40 & 0.68 & $PV^0 \rightarrow e^+ + PV^-$  \\
\hline
\end{tabular}
\end{center}
\end{table}
\esinglespace}

{\bsinglespace
\begin{figure}[p]
\begin{center}
%\fbox{
\includegraphics*[width=5in]{sensitivities_full_report_1}
%}
\end{center}
\caption[Transient current sensitivities]{
\label{fig:SensitivitesFull}
Transient current sensitivities.}
\end{figure}
\esinglespace}

% SSC:  this should be dropped now

% rabartl: I have commented this out

% 2007/08/22: rabartl: I removed this based on Scott's comment
%{}\noindent\textbf{Transient parameter-estimation problem with QASPR
%semiconductor model} [MOOCHO, Rythmos, NOX, Belos, Ifpack,
%Epetra]: We used the new forward sensitivity solver in Rythmos to solve
%transient parameter estimation problems using MOOCHO as the optimization
%algorithm [ToDo: rabartl: There is a small chance that we could have this working
%once we have basic forward sensitivities working].

%
\subsection{Block eigensolve for reacting flow problem}
%

{}\noindent\textit{Vertically integrated packages:} LOCA, NOX, Anasazi,
Stratimikos, Belos, ML, Ifpack, Amesos, Thyra, and Epetra

We successfully demonstrated large-scale eigenvalue calculations using block eigensolvers on the hydromagnetic Rayleight-Bernard (HRB) problem.  The HRB problem is important for verification of magnetohydrodynamics physics due to the existence of analytic solutions published by Chandresekhar.  The problem consists of a fluid sandwiched between two walls.  The lower wall is heated and the upper wall is cooled.  As the temperature gradient between the walls is increased (an increase in the Rayleigh number), a buoyancy driven instability occurs that transitions the fluid from a quiescent (no-flow) state to a recirculating (non-zero flow) state with repeating cells of rotating fluid.  Figure \ref{fig:hrbFlow} shows the flow solution for the recirculating state.

{\bsinglespace
\begin{figure}
\begin{center}
%\fbox{
\includegraphics*[angle=0,scale=0.3]{figures/ms_vx.eps}
\includegraphics*[angle=0,scale=0.3]{figures/ms_vy.eps}
\includegraphics*[angle=0,scale=0.3]{figures/ms_pres.eps}
\includegraphics*[angle=0,scale=0.3]{figures/ms_temp.eps}
\includegraphics*[angle=0,scale=0.3]{figures/ms_vectorpotential.eps}
\includegraphics*[angle=0,scale=0.3]{figures/ms_current.eps}
%}
\end{center}
\caption[Solution of the hydromagnetic Rayleigh-Bernard problem]{
\label{fig:hrbFlow}
Plot of the solution for a Rayleigh number of 2100 and magnetic field strength of 16 on the non-zero flow branch of the pitchfork bifurcation.}
\end{figure}
\esinglespace}
 
The onset of this instability (a pitchfork bifurcation point) can be located by monitoring the leading eigenvalues during a parameter continuation.  We continue in the Rayleigh number (Ra) with a fixed magnetic field strength.  After the bifurcation, the no-flow solution becomse unstable. Figure \ref{fig:hrbEigenvalues} shows the computed eigenvectors at a Rayleigh number of 2040, just past the bifurcation point at 2039.  This shows the perturbation to the base no-flow solution towards the recirculating cells.

{\bsinglespace
\begin{figure}
\begin{center}
%\fbox{
\includegraphics*[angle=0,scale=0.30]{figures/ms_eigenvalue_vx.eps}
\includegraphics*[angle=0,scale=0.30]{figures/ms_eigenvalue_vy.eps}
%}
\end{center}
\caption[Eigenvalues for the hydromagnetic Rayleigh-Bernard problem]{
\label{fig:hrbEigenvalues}
Plot of the eigenvalues for the x and y velocities.  This perturbation corresponds exactly to the flow solution above.}
\end{figure}
\esinglespace}
 
The problem was discretized into 5 million elements leading to a linear system with 5 million unknowns that was solved using 256 processors on tbird.  We used LOCA/NOX to solve the system of fully coupled nonlinear equations for a variety of Rayleigh numbers using arc-length continuation.  At the end of each continuation step, Anasazi is called to compute the eigenvalues.  The eigenvalue computation used Belos to perform Block and Pseudo-Block GMRES on the linear systems.  ML supplied the preconditioning for the linear solves.  ML internally used a 3 level V-cycle, calling IFPACK with ILU for the smoothers and Amesos (KLU) for the direct solve on the coarse grid.  

Teh eigenvalue calculation demonstrates a general capability through coupled Trilinos packages to perform large scale block eigenvalue calculations.  This will be a critical ASC capability for performaing stability and bifurcation analysis.

%
\subsection{Design optimization problem with Aria/SIERRA}
%

{}\noindent\textit{Vertically integrated packages:} MOOCHO, Stratimikos,
Belos, Ifpack, Thyra, and Epetra

{\bsinglespace
\begin{figure}
\begin{center}
%\fbox{
\includegraphics*[angle=0,scale=0.50
]{SiC_dY0.1.eps}
%}
\end{center}
\caption[Final optimization solution for Aria MEMS actuator design problem]{
\label{fig:ariaFinal}
Plot of the final Aria solution showing the deformed beam and Temperature
contours. The optimization algorithm found that an applied voltage of $1.934$
would cause the beam to exactly match the design criterion of having the top
corner of the beam deflect a distance of $0.05$ at steady-state.  }
\end{figure}
\esinglespace}

We have demonstrated the minimally invasive optimization algorithm in MOOCHO
on a MEMS Actuator problem in Aria/SIERRA.  In this problem, an applied
voltage across the Silicon Carbide beam causes resistive heating, which in
turn causes thermal expansion, which in turn causes the beam to deflect
upwards. The optimization problem was formulated as follows: find the value of
the applied voltage parameter so that the beam deflection most closely matches
a design value (of $0.05$). The proof-of-concept was successful, with the
optimization problem solving to $8$ digits of accuracy (Figure
{}\ref{fig:ariaFinal}). This demonstration also highlights the speed of the
invasive algorithms, as it solved the optimization problem in only twice the
time of solving a single steady-state calculation.

This Aria application demonstrates that the algorithms and software are
general and immediately applicable to ASC applications other than Charon. The
development of the ModelEvaluator interface will pave the way for more
Trilinos capabilities, such as Rythmos, to be assimilated into Aria. Since the
model evaluator was implemented at the Sierra Solution Control level, there is
a now a direct path for all Sierra applications (particularly implicit codes
such as Sierra/Adagio) to interface to all Trilinos analysis algorithms.


%
\section{Conclusions}
%

There are a number of conclusions that we have drawn as a result of this
milestone work:

\begin{itemize}

{}\item Predictive simulations capable of answering tomorrows questions
requires moving beyond the basic forward solve and requires the incorporation
of invasive technologies for sensitivities, optimization, and other advanced
numerical algorithms.

{}\item Solving complex numerical problems (such as transient sensitivities)
to the highest quality with the greatest efficiency requires the vertical
integration of many different types of advanced numerical algorithms that can
be tailored to the specific problem.

{}\item The vertical integration of a large number of advanced numerical
algorithms requires the development and adoption of standard interfaces.

{}\item Thyra standard interfaces for linear operators and vectors,
preconditioners and linear solvers, nonlinear models, and nonlinear solvers
have allowed the vertical integration of a large variety of numerical solvers
and access to a variety of nonlinear applications.

{}\item Application codes must present themselves as a ModelEvaluator and then
hand over nearly complete control to the numerical solver(s) in order to take
full advantage of advanced nonlinear numerical algorithms.  Monolithic forward
time stepping application codes can not take advantage of these more
sophisticated solution techniques.

{}\item Nightly building and testing of the development versions of the
application and Trilinos:

  \begin{itemize}

  {}\item results in better production results and better research,

  {}\item brings algorithm developers and application developers closer
  together allowing for better exchange of ideas and concerns,

  {}\item makes Trilinos a more customer focused effort,

  {}\item helps drive algorithm development, and
        
  {}\item reduces barriers for new algorithms to have impact on production
  applications.

  \end{itemize}

{}\item Other application projects and scientific support software projects
should consider adopting the type of continuous integration that is used with
Charon + Trilinos that was developed as part of this milestone work.

\end{itemize}


\section{ToDo : Temporary Section}

\begin{itemize}

{}\item Fill in the text and the results for each of the ``demonstrate''
vertical solver examples.

{}\item We need to add some references here and fill in the missing references
above.

{}\item rjhoeks:  Give some references for QASPR and Charon

{}\item sscoll: Read and polish some the a) abstract, b) executive summary, c)
introduction, d) conclusions, e) captions for various figures.  These are the
things that people are most likely to read before they read anything else and
therefore should be of the best quality.

{}\item ???

\end{itemize}

% ---------------------------------------------------------------------- %
% References
%
\clearpage
\bibliographystyle{plain}
\bibliography{references}
\addcontentsline{toc}{section}{References}

% ---------------------------------------------------------------------- %
% Appendices should be stand-alone for SAND reports. If there is only
% one appendix, put \setcounter{secnumdepth}{0} after \appendix
%
%\appendix
%\input{???}

%\begin{SANDdistribution}
%\end{SANDdistribution}

\end{document}
