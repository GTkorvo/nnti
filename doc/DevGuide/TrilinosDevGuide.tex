\documentclass[12pt,relax]{TrilinosDevGuide}

%
% Set the title, author, and date
%
    \title{Trilinos Developer's Guide}
\SANDsubtitle{}


    \author{James Willenbring\\
       Computational Mathematics \& Algorithms \\
	  Sandia National Laboratories\\
	  P.O. Box 5800\\
	  Albuquerque, NM 87185-1110 \\
	  jmwille@sandia.gov \\
	 }

    % While this document is under active development, the date
    % field will reflect the current date, eventually a final date
    % will be assigned.
%    \today - Latex spits out errors when this is used here

\SANDnum{SAND2003-xxxx}
\SANDprintDate{February 2003}
\SANDauthor{James Willenbring, Sandia National Laboratories}


\SANDreleaseType{Unlimited Release}


\SANDdistcategory{UC-999}     % DOE mandates it, but many reports don't have it


%
% Start the document
%
    \begin{document}
	\maketitle

%
% Page style chosen that prints chapter heading and page number in the 
% header on each page.
%

    \pagestyle{headings}

    % -------------------------------------------------- %
    % Acknowledgement section
    % Use \section* since we don't want it in the table of context
    %
    %\clearpage - this is the beginning of the document
    \section*{Acknowledgement}
The author would like to acknowledge the support of the ASCI and LDRD 
programs that funded development of Trilinos and recognize all Trilinos 
contributors: Michael Heroux, Teri Barth, David Day, Bob Heaphy, 
Robert Hoekstra, Jonathan Hu, Tammy Kolda, Richard Lehoucq, Kevin Long, 
Roger Pawlowski, Andrew Rothfuss, Andrew Salinger, Ken Stanley, Ray 
Tuminaro, Jim Willenbring, and Alan Williams.

    % --------------------------------------------------------- %
    % The table of contents and list of figures and tables
    % Comment out \listoffigures and \listoftables if there are no
    % figures or tables. Make sure this starts on an odd numbered page
    %
    \clearpage
    \tableofcontents
    \listoffigures
    \listoftables



% ------------------------------------------- %
% Introduction to Developer's Guide
%
    \chapter{Introduction}
	\section{Briew Overview}
	\begin{quote}
The Trilinos Project is an effort to develop parallel solver algorithms and 
libraries within 
an object-oriented software framework for the solution of large-scale, complex
multi-physics engineering and scientific applications.   Our emphasis is on 
developing robust, scalable algorithms in a software framework, using abstract 
interfaces for flexible interoperability of components and providing a 
full-featured set of concrete classes that implement all abstract interfaces. 
Trilinos components are primarily written in C++, but provide essential C and 
Fortran user interface support.  We provide an open architecture that allows 
easy integration with other solver packages and we deliver our software to 
the outside community via the Gnu Lesser General Public License
(LGPL)~\cite{gnu-license-site}.
	\end{quote}
% Figure out how to cite Mike's overview doc
	\section{Motivation}
	\begin{quote}
Research efforts in advanced solution algorithms and parallel solver
libraries have historically had a large impact on engineering and
scientific computing.  Algorithmic advances increase the range
of tractable problems and reduce the cost of solving existing
problems.  Well-designed solver libraries provide a mechanism for
leveraging solver development across a broad set of applications and
minimize the cost of solver integration.  Emphasis is
required in both new algorithms and new software in order
to achieve the maximum impact of efforts.

The Trilinos project encompasses a variety of efforts that are to some
extent self-contained but at the same time inter-related.  The
Trilinos design allows individual packages to grow and mature
autonomously to the extent the algorithms and package developers
dictate. 
	\end{quote}

	\section{What is Covered in this Guide}
**(see lines 230-243)

The Trilinos Developer's Guide is meant to assist existing, as well as new and
potential Trilinos developers.  Topics covered include how to configure and 
build Trilinos, what is required to integrate an existing package into Trilinos
and examples of how those requirements can be met, as well as what tools are 
available to Trilinos packages.  Also discussed are some common practices that 
are followed by many Trilinos package developers; these are found in the 
chapter entitled ``Suggested practices''.  Finally, a graphical depiction of 
Trilinos package iteroperability is supplied along with a list of platforms 
that Trilinos has been ported to.

For a higher-level view of the Trilinos project, please see **(Cite An Overview
of the Trilinos Project by Mike Heroux). 

% start reading Mike's stuff at 243

	\chapter{Requirements \& Guildlines}
	**(Req's and how to satisfy them - break into sections)**



	\chapter{Suggested Practices}
	**(suggested coding guidelines, and other non-manditory practices that are encouraged - break up.  See Overview Doc pg 11,14-15.)**
	


	\chapter{Services Available to Trilinos Packages}
	A number of services exist for Trilinos packages.
	\section{Configuration Management}
	**(See Overview Doc pg 12)**
Autoconf~\cite{Autoconf},  Automake~\cite{Automake} and
Libtool~\cite{Libtool} provide a robust, full-featured set of tools for
building software across a broad set of platforms (see also the ``Goat
Book''~\cite{GoatBook}).  Although these
tools are not official standards, they are commonly used in many
packages.  Many existing
Trilinos packages use Autoconf and Automake (and will use
Libtool in the future).  However, use of these tools is not required.

Package developers who are not currently using autotools, but would like
to, can get a jump start by using a Trilinos package called 
new_package.  This trivial package exists for one primary 
purpose.  It walks a developer through the process of setting up a 
package to configure and build using autotools.  General instructions for
how to get started can be found in Trilinos/packages/new_package/README.  
Please note that new_package is a work in progess, suggestions and 
contributions are welcome, especially for FAQ's.

Trilinos provides a set of M4~\cite{M4} macros that can be used by any other
package that wants to use Autoconf and Automake for configuring and
building libraries.  These macros perform common configuration tasks such as
locating a valid LAPACK~\cite{lapack} library, or checking for a user-
defined MPI C compiler.  The macros can be found in the Trilinos CVS 
repository in Trilinos/config.  These macros minimize the amount of redudant
 effort in using Autotools, and make it easier to apply a general change to 
the configure process for all packages.
	\section{Regression Testing}
Trilinos provides a variety of regression
testing capabilities.  Within a number of Trilinos packages, we employ
``white box'' testing where detailed information about the software is
used and probed.  In addition, Trilinos performs ``black box'' testing
of packages via the Trilinos Solver Framework (TSF) virtual class
interfaces.  Any package that implements the TSF interfaces (see
Section~\ref{subsect:InteropTSF} below **(MAKE SURE BELOW, NOTE ABOVE)), can be tested via this black box
test environment.  ({\bf NOTE: Black box testing via TSF is not in
place at this time}
	\section{Periodic Testing}
Trilinos Packages that configure and build using Autotools can easily 
utilize the the Trilinos testharness.  The testharness performs a CVS update
(gets the most recent source code) every night and then builds the libraries
and runs any tests that have been integrated into the testharness.  
Currently the testharness only runs on a Linux platform, but it will 
eventually run on 5-8 platforms.  Packages that have not ported to a 
particular platform can be excluded from the testing process on that 
platform.  Packages that do not have any tests integrated into the 
testharness can still benefit by ensuring that libraries build without 
errors.  Integrating existing tests into the testharness is not difficult.  
The process is discussed in Trilinos/testharness/HowToAddToTestHarness.  
Please note that this document is a work in progress.

	\section{Source Code Repository and Build Tools}
	**(See Overview Doc pg 12)**
Source code repository and build tools: 

\subsection CVS Repository
Trilinos source code is maintained in a CVS~\cite{CVS} repository.  It is 
very easy to add new packages to the repository.  Packages that already use 
CVS can even rettain their CVS history!  To access the repository, one must 
have an account on software.sandia.gov.  Once an account has been granted, 
set the following two environment variables (replace ``your_user_name'' 
with your user name on software):

\begin{verbatim}
CVSROOT :ext:your_user_name@software.sandia.gov:/space/CVS
CVS_RSH ssh
\end{verbatim}

For those not familiar with CVS, below is a brief discussion covering some 
of the most common CVS commands.  For more information, see the Gnu CVS Home
Page~\cite{CVS}.

\triangleright Checking Out a Working Copy

To get started, checkout a copy of the development branch of the repository.
(Releases branches can be obtained by by checking out the appropriate 
tagged version of the repository.)

\begin{verbatim}
cvs checkout Trilinos
\end{verbatim}

\triangleright Updating a Woring Copy
To update after a version has been obtained use the ``update'' command.  
First, cd to the directory that is to be updated (usually the Trilinos root 
directory).  Then type:

\begin{verbatim}
cvs -q update -dP
\end{verbatim}

The ``-q'' option means ``be somewhat quiet''.  Try the command without this
option to see what it does.  

The ``-d'' option means to get any new directories.  For example, if a new 
package is added to the repository, but the ``-d'' option is not used, that 
new package will never appear in the working copy.  However, the first time 
that the ``-d'' option is used, all of the new package directories will be 
downloaded, and from that time on, all CVS updates will update the 
directories that were downloaded.  It is good practice to include this 
option for every CVS update.

... Decide if this section is worth it, or if people should read the doc.  If eexpanded, add info about when to check in, and which branch...

\subsection Bonsai
A lot of useful information related to CVS history is accessible via a
web-based interface package called Bonsai~\cite{Bonsai}.  This tool can be 
found on the web at ``http://software.sandia.gov/bonsai''.  Bonsai gives a 
developer the ability to view the changes made to the files in the 
repository.  The tool can be especially useful when trying to figure out which 
changes may have introduced bugs into a piece of code.  Developers can search 
for changes based on filename, directory, branch, date, user who made the 
change, or any combination of these criteria.  The entire revision histories of
individual files returned in a search can be utilized in finding the source of 
bugs.  The differences between any two versions of a file may be viewed.  

\subsection Bugzilla

Features and bug reports are tracked using Bugzilla~\cite{Bugzilla}.  Bugzilla 
can be found on the web at ``http://software.sandia.gov/bugzilla''.  All bugs 
related to any package of Trilnos that uses Bugzilla should be submitted to 
Bugzilla.  This even applies to cases in which one developer diagnoses and 
fixes a bug within a short period of time.  A bug report is still very 
valuable in this case because it provides an artifact that outlines the 
problem and explains how the problem was fixed.  

NOTE: In the context of Bugzilla, ``bug'' can refer not only to an error in 
existing code, but also to a desired enhancement.  For example, a bug report 
should be submitted to Bugzilla to report a segmentation fault that occurs 
when using an existing Ifpack preconditioner, and a bug report should also be
submitted to request a new Ifpack preconditioner.

\subsection Mailman

Email lists are maintained for Trilinos as a whole and for each package 
through Mailman~\cite{Mailman}.  This tool can be found on the web at 
``http://software.sandia.gov/mailman/listinfo''.  Support for new packages can 
easily be added.  Each package usually has four mailing lists.  The mailing 
lists listed below are to be used for issues relating to all of Trilinos.  The 
names for the lists pertaining to individual packages follow the same naming 
scheme, simply replace ``Trilinos'' with the name of the package.  For example 
the list for Trilnos users is called Trilinos-Users and the email address is 
\begin{verbatim}trilinos-users@software.sandia.gov\end{verbatim}.  The list 
for Epetra users is called Epetra-Users and the associated email address is 
\begin{verbatim}epetra_users@software.sandia.gov\end{verbatim}.

\triangleright **list 4 general types, mention leaders list **



Tip : lists not sub/supersets of eachother...

**Find out which lists are available to outsiders.**
All 
tools are accessible from the main Trilinos website~\cite{Trilinos-home-page}.

**Consider an example showing how tools can work together to fix bugs.**
**(Break this down and talk about how to use the various tools)**

	\chapter{Tools Available to Trilinos Packages}
	**(Maybe break up by category and then by tool - reword title, this section for software that doesn't need to be duplicated)**
	\section{Portable Interface to BLAS and LAPACK}
	**(See Overview Doc pg 12)**

Portable interface to BLAS and LAPACK: The Basic Linear Algebra
Subprograms (BLAS)~\cite{BLAS1,BLAS2,BLAS3} and LAPACK~\cite{lapack}
provide a large repository of robust, high-performance mathematical
software for serial and shared memory parallel dense linear algebra
computations.  However, the BLAS and LAPACK interfaces are Fortran
specifications, and the mechanism for calling Fortran interfaces from
C and C++ varies across computing platforms.  Epetra (and Tpetra)
provide a set of simple, portable interfaces to the BLAS and LAPACK
that provide uniform access to the BLAS and LAPACK across a broad
set of platforms.  These interfaces are accessible to
other packages.
**(Expand on this)**


	\chapter{Integrating a Package into Trilinos}
	**(list formal? process, meet above requirements Overview Doc pg 11,14-15)**




	\chapter{Getting Started}
	**(How to configure and build Trilinos)**
	**(Need intro! - also include examples!)**
\section Trilinos Configuration Options

The following options apply to all Trilinos packages unless 
the option doesn't make sense for a particular package (for example, a 
package that does not include any Fortran code will not be sensitive to 
F77=g77), or otherwise noted.  NOTE: This list is not yet complete, in 
particular many options that apply to only a subset of Trilinos packages 
are not included.  For options specific to individual package, 'cd' to the 
home directory of the source code of the individual package and type 
``configure --help'' (without quotes).

\triangleright Basic Options

\bullet --enable-debug 

(Nox only.)  This turns on compiler debugger flags. It has 
not been fully tested. As an alternate, specify CXXFLAGS on the 
                 configure line.

\bullet --enable-opt

(Nox only.)  This turns on compiler optimization flags. It 
has not been fully tested. As an alternate, specify CXXFLAGS on the 
                 configure line. 

\bullet --with-cppflags 

Specify additional preprocessor flags (e.g., "-Dflag -Idir") 

\bullet --with-cxxflags 

Specify additional C++ flags 

\bullet --with-ldflags 
Specify additional linker flags (e.g., "-Ldir") 

\bullet --with-ar 
Specify a special archiver command, the default is "ar cru". 

\triangleright Influential Environmental Variables

\bullet CC 

C compiler command.

\bullet CFLAGS 

C compiler flags.

\bullet CXX 

C++ compiler command.

\bullet CXXFLAGS 

C++ compiler flags.

\bullet LDFLAGS 

Specify linker flags.

\bullet CPPFLAGS 

C/C++ preprocessor flags.

\bullet CXXCPP 

C++ preprocessor.

\bullet F77 

Fortran 77 compiler command.

\bullet FFLAGS 

Fortran 77 compiler flags.

\triangleright MPI-Related Options

\bullet --enable-mpi 

Enables MPI mode. Defines HAVE_MPI in the (Package)_Config.h file. Will test 
for the ability to preprocess the MPI header file and may test ability to link 
with MPI.

\bullet --with-mpi-cxx 

If no argument is specified, uses "mpiCC". Otherwise, uses specified MPI C++
compiler. Automatically enables MPI mode. 

\bullet --with-mpi=MPIROOT 

Specify the MPI root directory. Automatically enables MPI mode. 

\bullet --with-mpi-libs="LIBS" 

Specify the MPI libraries. Defaults to "-lmpi" if either --with-mpi or 
--with-mpi-libdir is specified.

\bullet --with-mpi-incdir=DIR

Specify the MPI include files location. Defaults to MPIROOT/include if 
--with-mpi is specified. If multiple directories  must be specified, try 
--with-cppflags="-I<dir1> -I<dir2>" instead.

\bullet --with-mpi-libdir=DIR 

Specify the MPI libraries location. Defaults to MPIROOT/lib if --with-mpi 
is specified. If multiple directories must be specified, try 
--with-ldflags="-L<dir1> -L<dir2>" instead. 

   Developer-Related Options

\bullet --enable-maintainer-mode 

Enable make rules and dependencies not useful (and sometimes confusing) to 
the casual installer.

\triangleright Other important notes about the configure/build process.

\circ Any code that links to Trilinos should define 'HAVE_CONFIG_H' (without
quotes).

	\chapter{Interoperability Status for Existing Trilinos Packages}

	\chapter{Platform Portablility}
	**(List platforms - encourage script submission)**
    % ---------------------------------------------------------------------- %
    % References
    %
    \clearpage
    \bibliographystyle{plain}
    \bibliography{TrilinosDevGuide}
    \addcontentsline{toc}{section}{References}

% Include Appendices??  If they are needed, they go here.


\end{document}
